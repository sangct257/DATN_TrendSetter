<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<!-- Th√™m m·ªôt ch√∫t CSS ƒë·ªÉ c·∫£i thi·ªán giao di·ªán -->
<head th:replace="admin/fragments/head :: head"></head>
<style>
    /* Thi·∫øt k·∫ø t·ªïng th·ªÉ cho card */
    .card1 {
        border: 1px solid #ddd;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease-in-out;
    }

    /* Th√™m hi·ªáu ·ª©ng hover cho card */
    .card1:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    /* C·∫£i thi·ªán card-body */
    .card1-body {
        padding: 20px;
        background-color: #000000;
        border-radius: 10px;
        color: #333;
    }

    /* Thi·∫øt k·∫ø ti√™u ƒë·ªÅ */
    h2 {
        font-family: 'Roboto', sans-serif;
        font-size: 28px;
        font-weight: 600;
        color: #2c3e50;
    }

    /* Kho·∫£ng c√°ch gi·ªØa c√°c card */
    .mb-3 {
        margin-bottom: 20px;
    }

    /* L√†m ƒë·∫≠m c√°c nh√£n v√† c·∫£i thi·ªán kh√¥ng gian */
    .font-weight-bold {
        font-weight: 700;
        font-size: 16px;
        color: #16a085;
    }

    /* C√°c ph·∫ßn t·ª≠ tƒÉng tr∆∞·ªüng v·ªõi m√†u s·∫Øc */
    .growth {
        font-size: 16px;
        color: #e74c3c; /* M√†u ƒë·ªè ƒë·ªÉ t·∫°o ƒëi·ªÉm nh·∫•n */
    }

    /* C·∫£i thi·ªán kho·∫£ng c√°ch gi·ªØa c√°c ph·∫ßn t·ª≠ */
    .ml-2 {
        margin-left: 10px;
    }

    /* C·∫£i thi·ªán giao di·ªán c·ªßa c√°c s·ªë li·ªáu */
    #doanhThuNgayNay,
    #doanhThuThangNay,
    #doanhThuNamNay,
    #soLuongSanPhamThangNay,
    #soLuongHoaDonNgayNay,
    #soLuongHoaDonThangNay {
        font-size: 18px;
        font-weight: bold;
        color: #27ae60; /* M√†u xanh l√° c√¢y cho c√°c gi√° tr·ªã */
    }

    /* C·∫£i thi·ªán v·ªã tr√≠ v√† cƒÉn gi·ªØa */
    .text-center {
        text-align: center;
    }

    /* T·∫°o hi·ªáu ·ª©ng ƒë·∫πp cho ch·ªØ s·ªë v√† % */
    #tangTruongNgay,
    #tangTruongThang,
    #tangTruongNam,
    #tangTruongSanPham,
    #tangTruongHoaDonNgay,
    #tangTruongHoaDonThang {
        font-size: 16px;
        font-weight: 600;
        color: #f39c12; /* M√†u v√†ng ƒë·ªÉ l√†m n·ªïi b·∫≠t ph·∫ßn tƒÉng tr∆∞·ªüng */
    }

</style>
<!-- Th√™m m·ªôt s·ªë hi·ªáu ·ª©ng CSS cho ƒë·∫πp h∆°n -->
<body class="hold-transition skin-blue sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">

    <div th:replace="admin/fragments/header :: header"></div>
    <!-- =============================================== -->

    <!-- Left side column. contains the sidebar -->
    <div th:replace="admin/fragments/sidebar :: sidebar"></div>

    <!-- =============================================== -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                Th·ªëng K√™
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i><a href="/admin">Home</a></a></li>
                <li><a href="#">Th·ªëng K√™</a></li>
            </ol>
        </section>

        <!-- Main content -->
        <section class="content">

            <!-- Default box -->
            <div class="box">
                <div class="box-body">
                    <div class="container mt-4">
                        <div class="row">
                            <!-- C·ªôt b√™n tr√°i ch·ª©a c√°c th·∫ª th√¥ng tin (cards) -->
                            <div class="col-md-4">
                                <div class="card text-white bg-primary mb-3">
                                    <div class="card-body">
                                        <h5 class="card-title">Doanh s·ªë th√°ng n√†y</h5>
                                        <p class="display-4" th:text="${soLuongHoaDonThangNay}"></p>
                                        <!-- Hi·ªÉn th·ªã s·ªë l∆∞·ª£ng h√≥a ƒë∆°n -->
                                        <p class="h4" th:if="${doanhThuThangNay == 0}">0 VND</p>
                                        <p class="h4" th:if="${doanhThuThangNay != 0}"
                                           th:text="${#numbers.formatInteger(doanhThuThangNay, 3, 'COMMA') + ' VND'}"></p>

                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="card text-white bg-warning mb-3">
                                    <div class="card-body">
                                        <h5 class="card-title">Doanh s·ªë h√¥m nay</h5>
                                        <p class="display-4" th:text="${soLuongHoaDonNgayNay}"></p>
                                        <!-- Hi·ªÉn th·ªã s·ªë l∆∞·ª£ng h√≥a ƒë∆°n -->
                                        <p class="h4" th:if="${doanhThuNgayNay == 0}">0 VND</p>
                                        <p class="h4" th:if="${doanhThuNgayNay != 0}"
                                           th:text="${#numbers.formatInteger(doanhThuNgayNay, 3, 'COMMA') + ' VND'}"></p>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="card text-white bg-success mb-3">
                                    <div class="card-body">
                                        <h5 class="card-title">S·∫£n ph·∫©m b√°n ƒë∆∞·ª£c trong th√°ng</h5>
                                        <p class="display-4" th:text="${soLuongSanPhamThangNay}"></p>
                                        <!-- T·ªïng s·∫£n ph·∫©m -->
                                        <p class="h4">S·∫£n ph·∫©m</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="container mt-5">
                            <h2 class="text-center mb-4">Bi·ªÉu ƒë·ªì Th·ªëng K√™ B√°n H√†ng</h2>

                            <!-- B·ªô l·ªçc -->
                            <div class="row justify-content-center mb-4">
                                <div class="col-md-10 d-flex justify-content-around">
                                    <button type="button" class="btn btn-outline-primary" id="dayFilter">Ng√†y</button>
                                    <button type="button" class="btn btn-outline-primary" id="sevenDaysFilter">7 Ng√†y
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" id="monthFilter">Th√°ng
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" id="yearFilter">NƒÉm</button>
                                    <button type="button" class="btn btn-outline-primary" id="customFilter">T√πy ch·ªânh
                                    </button>
                                </div>
                                <!-- T√πy ch·ªânh ng√†y (hi·ªÉn th·ªã khi ch·ªçn T√πy ch·ªânh) -->
                                <div class="row justify-content-center text-center" id="customDateRange"
                                     style="display: none;">
                                    <div class="col-md-10 d-flex justify-content-around">
                                        <div class="col-md-6">
                                            <div class="input-group">
                                                <input type="date" id="startDate"
                                                       class="form-control form-control-lg rounded-pill border-0 shadow-sm"
                                                       placeholder="Ng√†y b·∫Øt ƒë·∫ßu">
                                            </div>
                                        </div>
                                        <div class="col-md-2"></div>
                                        <div class="col-md-6">
                                            <div class="input-group">
                                                <input type="date" id="endDate"
                                                       class="form-control form-control-lg rounded-pill border-0 shadow-sm"
                                                       placeholder="Ng√†y k·∫øt th√∫c">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bi·ªÉu ƒë·ªì -->
                            <div class="row justify-content-center mt-5">
                                <div class="col-md-10">
                                    <div class="card shadow-lg border-0 rounded-4">
                                        <div class="card-header text-center bg-gradient-primary text-black rounded-4">
                                            <h4 class="m-1">Bi·ªÉu ƒê·ªì Th·ªëng K√™ B√°n H√†ng</h4>
                                        </div>
                                        <div class="card-body py-4 px-5">
                                            <canvas id="myChart" height="500"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Top s·∫£n ph·∫©m Trong th√°ng -->
                        <div class="container mt-5">
                            <!-- D√≤ng ƒë·∫ßu ti√™n: Top S·∫£n Ph·∫©m B√°n Ch·∫°y v√† Tr·∫°ng Th√°i ƒê∆°n H√†ng -->
                            <div class="row mt-5">
                                <!-- C·ªôt b√™n tr√°i: Top S·∫£n Ph·∫©m B√°n Ch·∫°y -->
                                <div class="col-md-6 border-dark shadow-lg border-0 rounded-4">
                                    <h2 class="text-center">Top S·∫£n Ph·∫©m B√°n Ch·∫°y Trong Th√°ng</h2>
                                    <div id="productsList" class="list-group">
                                        <div class="shadow-lg border-0 rounded-4">
                                            <table id="productTable" class="table table-striped table-bordered">
                                                <thead class="table-dark">
                                                <tr class="text-center">
                                                    <th scope="col">STT</th>
                                                    <th scope="col">H√¨nh ·∫¢nh</th>
                                                    <th scope="col">T√™n S·∫£n Ph·∫©m</th>
                                                    <th scope="col">Gi√°</th>
                                                    <th scope="col">T·ªïng S·ªë L∆∞·ª£ng B√°n</th>
                                                </tr>
                                                </thead>
                                                <tbody class="text-center">
                                                <tr th:each="product, iterStat : ${productsPage}">
                                                    <td th:text="${iterStat.index + 1}"></td> <!-- STT -->
                                                    <td>
                                                        <img th:src="${product[0]}" alt="H√¨nh ·∫¢nh" width="80">
                                                    </td> <!-- H√¨nh ·∫£nh -->
                                                    <td th:text="${product[1]}"></td> <!-- T√™n s·∫£n ph·∫©m -->
                                                    <td th:text="${#numbers.formatInteger(product[2], 3, 'COMMA') + ' VND'}"></td> <!-- Gi√° s·∫£n ph·∫©m -->
                                                    <td style="color: red; font-weight: bold; font-size: 1.2em;" th:text="${product[4]}"></td> <!-- T·ªïng s·ªë l∆∞·ª£ng b√°n -->
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <!-- C·ªôt b√™n ph·∫£i: Tr·∫°ng Th√°i ƒê∆°n H√†ng -->
                                <div class="col-md-6 border-dark shadow-lg border-0 rounded-4">
                                    <h2 class="text-center">Tr·∫°ng Th√°i ƒê∆°n H√†ng Th√°ng N√†y</h2>
                                    <canvas id="orderStatusChart" class="card shadow-lg border-0 rounded-4"
                                            style="width: 60%; height: 200px;"></canvas>
                                </div>

                            </div>

                            <!-- D√≤ng th·ª© hai: S·∫£n Ph·∫©m S·∫Øp H·∫øt H√†ng v√† T·ªëc ƒê·ªô TƒÉng Tr∆∞·ªüng -->
                            <div class="row mt-5">
                                <!-- C·ªôt b√™n tr√°i: S·∫£n Ph·∫©m S·∫Øp H·∫øt H√†ng -->
                                <div class="col-md border-dark shadow-lg border-0 rounded-4">
                                    <h2 class="text-center">S·∫£n Ph·∫©m S·∫Øp H·∫øt H√†ng</h2>
                                    <div id="lowStockList" class="list-group">
                                        <div class="shadow-lg border-0 rounded-4">
                                            <table id="productTable1" class="table table-striped table-bordered">
                                                <thead class="table-dark">
                                                <tr class="text-center">
                                                    <th scope="col">STT</th>
                                                    <th scope="col">H√¨nh ·∫¢nh</th>
                                                    <th scope="col">T√™n S·∫£n Ph·∫©m</th>
                                                    <th scope="col">Gi√°</th>
                                                    <th scope="col">C√≤n L·∫°i</th>
                                                </tr>
                                                </thead>
                                                <tbody class="text-center">
                                                <tr th:each="lowStockProduct, iterStat : ${lowStockProducts}">
                                                    <td th:text="${iterStat.index + 1}"></td>
                                                    <td>
                                                        <img th:src="${lowStockProduct.hinhAnh[0].urlHinhAnh}"
                                                             alt="H√¨nh ·∫¢nh" width="80">
                                                    </td>
                                                    <td th:text="${lowStockProduct.sanPham.tenSanPham + ' - ' + lowStockProduct.mauSac.tenMauSac + ' - ' + lowStockProduct.kichThuoc.tenKichThuoc}"></td>
                                                    <td th:text="${#numbers.formatInteger(lowStockProduct.gia, 3, 'COMMA') + ' VND'}"></td>
                                                    <td style="color: red; font-weight: bold; font-size: 1.2em;"
                                                        th:text="${lowStockProduct.soLuong}"></td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <!-- C·ªôt b√™n ph·∫£i: T·ªëc ƒê·ªô TƒÉng Tr∆∞·ªüng C·ª≠a H√†ng -->
                                <div class="col-md-6 border-dark shadow-lg border-0 rounded-4">
                                    <h2 class="text-center mb-4">T·ªëc ƒê·ªô TƒÉng Tr∆∞·ªüng C·ª≠a H√†ng</h2>
                                    <div class="shadow-lg border-0 rounded-4">
                                        <!-- Doanh thu ng√†y -->
                                        <div class="card1 mb-3">
                                            <div class="card1-body d-flex justify-content-between align-items-center">
                                                <span class="font-weight-bold">üìÖ Doanh thu ng√†y </span>
                                                <span id="doanhThuNgayNay" class="font-weight-bold">1.000.000 ‚Ç´</span>
                                                <span class="growth ml-2 text-center" id="tangTruongNgay">100%</span>
                                            </div>
                                        </div>

                                        <!-- Doanh thu th√°ng -->
                                        <div class="card1 mb-3">
                                            <div class="card1-body d-flex justify-content-between align-items-center">
                                                <span class="font-weight-bold">üìÖ Doanh thu th√°ng </span>
                                                <span id="doanhThuThangNay">...</span>
                                                <span class="growth ml-2 text-center" id="tangTruongThang">...</span>
                                            </div>
                                        </div>

                                        <!-- Doanh thu nƒÉm -->
                                        <div class="card1 mb-3">
                                            <div class="card1-body d-flex justify-content-between align-items-center">
                                                <span class="font-weight-bold">üìÖ Doanh thu nƒÉm </span>
                                                <span id="doanhThuNamNay">...</span>
                                                <span class="growth ml-2 text-center" id="tangTruongNam">...</span>
                                            </div>
                                        </div>

                                        <!-- S·∫£n ph·∫©m th√°ng -->
                                        <div class="card1 mb-3">
                                            <div class="card1-body d-flex justify-content-between align-items-center">
                                                <span class="font-weight-bold">üì¶ S·∫£n ph·∫©m th√°ng </span>
                                                <span id="soLuongSanPhamThangNay">...</span>
                                                <span class="growth ml-2 text-center" id="tangTruongSanPham">...</span>
                                            </div>
                                        </div>

                                        <!-- H√≥a ƒë∆°n ng√†y -->
                                        <div class="card1 mb-3">
                                            <div class="card1-body d-flex justify-content-between align-items-center">
                                                <span class="font-weight-bold">üßæ H√≥a ƒë∆°n ng√†y </span>
                                                <span id="soLuongHoaDonNgayNay">...</span>
                                                <span class="growth ml-2 text-center" id="tangTruongHoaDonNgay">...</span>
                                            </div>
                                        </div>

                                        <!-- H√≥a ƒë∆°n th√°ng -->
                                        <div class="card1 mb-3">
                                            <div class="card1-body d-flex justify-content-between align-items-center">
                                                <span class="font-weight-bold">üßæ H√≥a ƒë∆°n th√°ng </span>
                                                <span id="soLuongHoaDonThangNay">...</span>
                                                <span class="growth ml-2 text-center" id="tangTruongHoaDonThang">...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <!-- /.box -->

        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    <div th:replace="admin/fragments/footer :: footer"></div>


</div>
<!-- ./wrapper -->

<!-- jQuery 3 -->

<!-- Th√™m c√°c t√†i nguy√™n JavaScript (jQuery, v.v.) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<div th:replace="admin/fragments/script :: script"></div>

<!-- Th√™m Chart.js JS ƒë·ªÉ t·∫°o bi·ªÉu ƒë·ªì -->
<script th:inline="javascript">
    document.addEventListener("DOMContentLoaded", function () {
        // L·∫•y gi√° tr·ªã t·ª´ c√°c thu·ªôc t√≠nh data-value
        const doanhThuNgayNay = /*[[${doanhThuNgayNay}]]*/ 0;
        const doanhThuThangNay = /*[[${doanhThuThangNay}]]*/ 0;
        const doanhThuNamNay = /*[[${doanhThuNamNay}]]*/ 0;
        const soLuongSanPhamThangNay = /*[[${soLuongSanPhamThangNay}]]*/ 0;
        const soLuongHoaDonNgayNay = /*[[${soLuongHoaDonNgayNay}]]*/ 0;
        const soLuongHoaDonThangNay = /*[[${soLuongHoaDonThangNay}]]*/ 0;

        // D·ªØ li·ªáu tr∆∞·ªõc ƒë·ªÉ t√≠nh to√°n tƒÉng tr∆∞·ªüng
        const tangTruongNgay = /*[[${prevTangTruongNgay}]]*/ 0;
        const doanhThuThang = /*[[${prevDoanhThuThang}]]*/ 0; // ƒê√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª´ backend
        const doanhThuNam = /*[[${prevDoanhThuNam}]]*/ 0;
        const tangTruongSanPham = /*[[${tangTruongSanPham}]]*/ 0;
        const tangTruongHoaDonNgay = /*[[${tangTruongHoaDonNgay}]]*/ 0;
        const tangTruongHoaDonThang = /*[[${tangTruongHoaDonThang}]]*/ 0;

        // Hi·ªÉn th·ªã doanh thu
        document.getElementById("doanhThuNgayNay").textContent = formatCurrency(doanhThuNgayNay);
        document.getElementById("doanhThuThangNay").textContent = formatCurrency(doanhThuThangNay);
        document.getElementById("doanhThuNamNay").textContent = formatCurrency(doanhThuNamNay);
        document.getElementById("soLuongSanPhamThangNay").textContent = soLuongSanPhamThangNay + " S·∫£n ph·∫©m";
        document.getElementById("soLuongHoaDonNgayNay").textContent = soLuongHoaDonNgayNay + " H√≥a ƒë∆°n";
        document.getElementById("soLuongHoaDonThangNay").textContent = soLuongHoaDonThangNay + " H√≥a ƒë∆°n";

        // Hi·ªÉn th·ªã tƒÉng tr∆∞·ªüng
        document.getElementById("tangTruongNgay").textContent = calculateGrowth(tangTruongNgay, doanhThuNgayNay) + "%";
        document.getElementById("tangTruongThang").textContent = calculateGrowth(doanhThuThang, doanhThuThangNay) + "%";
        document.getElementById("tangTruongNam").textContent = calculateGrowth(doanhThuNam, doanhThuNamNay) + "%";
        document.getElementById("tangTruongSanPham").textContent = tangTruongSanPham + "%";
        document.getElementById("tangTruongHoaDonNgay").textContent = tangTruongHoaDonNgay + "%";
        document.getElementById("tangTruongHoaDonThang").textContent = tangTruongHoaDonThang + "%";

    });

    // H√†m t√≠nh to√°n % tƒÉng tr∆∞·ªüng
    function calculateGrowth(prevValue, currentValue) {
        if (prevValue === 0 || currentValue === 0) return 0; // Tr·∫£ v·ªÅ 0 n·∫øu kh√¥ng c√≥ d·ªØ li·ªáu
        return ((currentValue - prevValue) / prevValue * 100).toFixed(2);
    }

    // H√†m ƒë·ªãnh d·∫°ng s·ªë ti·ªÅn
    function formatCurrency(amount) {
        return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
    }
</script>

<script th:inline="javascript">

    var labels = /*[[${dates}]]*/ [];
    var salesData = /*[[${salesData}]]*/ [];
    var invoiceData = /*[[${invoiceData}]]*/ [];
    var originalLabels = labels;
    var originalSalesData = salesData;
    var originalInvoiceData = invoiceData;

    var ctx = document.getElementById('myChart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'S·ªë l∆∞·ª£ng s·∫£n ph·∫©m b√°n ra',
                    data: salesData,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                },
                {
                    label: 'S·ªë l∆∞·ª£ng h√≥a ƒë∆°n',
                    data: invoiceData,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    ticks: {autoSkip: false},
                    min: Math.max(0, labels.length - 12),
                    max: labels.length - 1
                },
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                zoom: {
                    pan: {
                        enabled: true,
                        mode: 'x',
                    },
                    zoom: {
                        wheel: {enabled: true},
                        pinch: {enabled: true},
                        mode: 'x',
                    }
                }
            }
        }
    });

    // Ch·ªçn b·ªô l·ªçc ng√†y
    document.getElementById('dayFilter').addEventListener('click', function () {
        updateChartData('1');
    });

    document.getElementById('sevenDaysFilter').addEventListener('click', function () {
        updateChartData('7');
    });

    document.getElementById('monthFilter').addEventListener('click', function () {
        updateChartData('30');
    });

    document.getElementById('yearFilter').addEventListener('click', function () {
        updateChartData('365');
    });

    document.getElementById('customFilter').addEventListener('click', function () {
        document.getElementById('customDateRange').style.display = 'block';
        updateChartData(); // reset chart if the custom filter is clicked
    });

    // S·ª≠ d·ª•ng ng√†y t√πy ch·ªânh
    document.getElementById('startDate').addEventListener('change', applyCustomDateFilter);
    document.getElementById('endDate').addEventListener('change', applyCustomDateFilter);

    function applyCustomDateFilter() {
        var startDate = document.getElementById('startDate').value;
        var endDate = document.getElementById('endDate').value;
        if (startDate && endDate) {
            updateChartData(null, startDate, endDate);
        }
    }

    // H√†m chu·∫©n h√≥a ng√†y (lo·∫°i b·ªè gi·ªù, ph√∫t, gi√¢y)
    function normalizeDate(date) {
        return new Date(date.getFullYear(), date.getMonth(), date.getDate()); // Ch·ªâ l·∫•y nƒÉm, th√°ng, ng√†y
    }

    function updateChartData(filterValue, startDate = null, endDate = null) {
        var filteredLabels = [];
        var filteredSalesData = [];
        var filteredInvoiceData = [];

        var currentDate = new Date();
        var filterDate;

        // Chu·∫©n h√≥a ng√†y hi·ªán t·∫°i
        currentDate = normalizeDate(currentDate);

        // X·ª≠ l√Ω b·ªô l·ªçc theo ng√†y, 7 ng√†y, th√°ng, nƒÉm
        if (filterValue) {
            switch (filterValue) {
                case '1': // Ng√†y
                    filterDate = normalizeDate(new Date()); // L·∫•y ng√†y h√¥m nay
                    break;
                case '7': // 7 Ng√†y
                    filterDate = new Date();
                    filterDate.setDate(currentDate.getDate() - 7); // 7 ng√†y tr∆∞·ªõc
                    filterDate = normalizeDate(filterDate); // Chu·∫©n h√≥a ng√†y
                    break;
                case '30': // Th√°ng
                    filterDate = new Date();
                    filterDate.setMonth(currentDate.getMonth() - 1); // 1 th√°ng tr∆∞·ªõc
                    filterDate = normalizeDate(filterDate); // Chu·∫©n h√≥a ng√†y
                    break;
                case '365': // NƒÉm
                    filterDate = new Date();
                    filterDate.setFullYear(currentDate.getFullYear() - 1); // 1 nƒÉm tr∆∞·ªõc
                    filterDate = normalizeDate(filterDate); // Chu·∫©n h√≥a ng√†y
                    break;
            }

            // L·ªçc d·ªØ li·ªáu theo ng√†y
            for (var i = 0; i < originalLabels.length; i++) {
                var dateParts = originalLabels[i].split(' - '); // Chia ng√†y th√†nh c√°c ph·∫ßn
                var labelDate = new Date(dateParts[2], dateParts[1] - 1, dateParts[0]); // T·∫°o ƒë·ªëi t∆∞·ª£ng Date t·ª´ ng√†y trong label
                labelDate = normalizeDate(labelDate); // Chu·∫©n h√≥a ng√†y trong label

                // ƒêi·ªÅu ki·ªán l·ªçc: labelDate ph·∫£i l·ªõn h∆°n ho·∫∑c b·∫±ng filterDate
                if (labelDate >= filterDate) {
                    filteredLabels.push(originalLabels[i]);
                    filteredSalesData.push(originalSalesData[i]);
                    filteredInvoiceData.push(originalInvoiceData[i]);
                }
            }
        } else if (startDate && endDate) { // T√πy ch·ªânh ng√†y
            var start = new Date(startDate);
            var end = new Date(endDate);

            // Chu·∫©n h√≥a ng√†y b·∫Øt ƒë·∫ßu v√† ng√†y k·∫øt th√∫c
            start = normalizeDate(start);
            end = normalizeDate(end);

            for (var i = 0; i < originalLabels.length; i++) {
                var dateParts = originalLabels[i].split(' - '); // Chia ng√†y th√†nh c√°c ph·∫ßn
                var labelDate = new Date(dateParts[2], dateParts[1] - 1, dateParts[0]); // T·∫°o ƒë·ªëi t∆∞·ª£ng Date t·ª´ ng√†y trong label
                labelDate = normalizeDate(labelDate); // Chu·∫©n h√≥a ng√†y trong label

                // ƒêi·ªÅu ki·ªán l·ªçc: labelDate ph·∫£i trong kho·∫£ng start v√† end
                if (labelDate >= start && labelDate <= end) {
                    filteredLabels.push(originalLabels[i]);
                    filteredSalesData.push(originalSalesData[i]);
                    filteredInvoiceData.push(originalInvoiceData[i]);
                }
            }
        }

        // C·∫≠p nh·∫≠t l·∫°i d·ªØ li·ªáu bi·ªÉu ƒë·ªì
        myChart.data.labels = filteredLabels;
        myChart.data.datasets[0].data = filteredSalesData;
        myChart.data.datasets[1].data = filteredInvoiceData;
        myChart.update();
    }
</script>

<script th:inline="javascript">
    /*<![CDATA[*/
    var processingPercentage = [[${processingPercentage}]];
    var waitingConfirmationPercentage = [[${waitingConfirmationPercentage}]];
    var confirmedPercentage = [[${confirmedPercentage}]];
    var waitingDeliveryPercentage = [[${waitingDeliveryPercentage}]];
    var shippingPercentage = [[${shippingPercentage}]];
    var completedPercentage = [[${completedPercentage}]];
    var paidPercentage = [[${paidPercentage}]];
    var finishedPercentage = [[${finishedPercentage}]];
    var cancelledPercentage = [[${cancelledPercentage}]];
    var failedPercentage = [[${failedPercentage}]];

    var ctx = document.getElementById('orderStatusChart').getContext('2d');

    var orderStatusChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['ƒêang X·ª≠ L√Ω', 'Ch·ªù X√°c Nh·∫≠n', 'ƒê√£ X√°c Nh·∫≠n', 'Ch·ªù V·∫≠n Chuy·ªÉn', 'ƒêang Giao H√†ng',
                'ƒê√£ Giao H√†ng', 'ƒê√£ Thanh To√°n', 'ƒê√£ Ho√†n Th√†nh', 'ƒê√£ H·ªßy', 'Ho√†n Tr·∫£'],
            datasets: [{
                label: 'Tr·∫°ng Th√°i ƒê∆°n H√†ng',
                data: [
                    processingPercentage,
                    waitingConfirmationPercentage,
                    confirmedPercentage,
                    waitingDeliveryPercentage,
                    shippingPercentage,
                    completedPercentage,
                    paidPercentage,
                    finishedPercentage,
                    cancelledPercentage,
                    failedPercentage
                ],
                backgroundColor: ['#28a745', '#ffc107', '#17a2b8', '#ffc0cb', '#dc3545', '#6c757d', '#007bff', '#8e44ad', '#f39c12', '#d35400'],
                borderColor: ['#218838', '#e0a800', '#138496', '#e0a0a0', '#c82333', '#5a6268', '#0056b3', '#6c3483', '#d68910', '#b03a2e'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    callbacks: {
                        label: function (tooltipItem) {
                            return tooltipItem.label + ': ' + tooltipItem.raw + '%';
                        }
                    }
                }
            }
        }
    });
    /*]]>*/
</script>

<!--Load table-->
<script>
    $(document).ready(function () {
        function initializeDataTable(tableId) {
            $(tableId).DataTable({
                "paging": true,
                "lengthMenu": [3, 5, 7, 9, 10, 20],
                "pageLength": 3,
                "autoWidth": false,
                "responsive": true,
                "language": {
                    "sProcessing": "ƒêang x·ª≠ l√Ω...",
                    "sLengthMenu": "Hi·ªÉn th·ªã _MENU_ d√≤ng",
                    "sZeroRecords": "Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu",
                    "sInfo": "Hi·ªÉn th·ªã _START_ ƒë·∫øn _END_ trong t·ªïng _TOTAL_ d√≤ng",
                    "sInfoEmpty": "Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã",
                    "sInfoFiltered": "(l·ªçc t·ª´ _MAX_ d√≤ng)",
                    "sSearch": "T√¨m ki·∫øm:",
                    "oPaginate": {
                        "sFirst": "ƒê·∫ßu",
                        "sPrevious": "Tr∆∞·ªõc",
                        "sNext": "Ti·∫øp",
                        "sLast": "Cu·ªëi"
                    }
                }
            });
        }

        // Kh·ªüi t·∫°o DataTable cho c·∫£ hai b·∫£ng
        initializeDataTable('#productTable');
        initializeDataTable('#productTable1');
    });

</script>
</body>
</html>
