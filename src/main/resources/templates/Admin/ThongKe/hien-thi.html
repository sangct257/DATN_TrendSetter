<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<!-- Th√™m m·ªôt ch√∫t CSS ƒë·ªÉ c·∫£i thi·ªán giao di·ªán -->
<head th:replace="admin/fragments/head :: head"></head>
<style>
    /* Thi·∫øt k·∫ø t·ªïng th·ªÉ cho card */
    .card1 {
        border: 1px solid #ddd;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease-in-out;
    }

    /* Th√™m hi·ªáu ·ª©ng hover cho card */
    .card1:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    /* C·∫£i thi·ªán card-body */
    .card1-body {
        padding: 20px;
        background-color: #000000;
        border-radius: 10px;
        color: #333;
    }

    /* Thi·∫øt k·∫ø ti√™u ƒë·ªÅ */
    h2 {
        font-family: 'Roboto', sans-serif;
        font-size: 28px;
        font-weight: 600;
        color: #2c3e50;
    }

    /* Kho·∫£ng c√°ch gi·ªØa c√°c card */
    .mb-3 {
        margin-bottom: 20px;
    }

    /* L√†m ƒë·∫≠m c√°c nh√£n v√† c·∫£i thi·ªán kh√¥ng gian */
    .font-weight-bold {
        font-weight: 700;
        font-size: 16px;
        color: #16a085;
    }

    /* C√°c ph·∫ßn t·ª≠ tƒÉng tr∆∞·ªüng v·ªõi m√†u s·∫Øc */
    .growth {
        font-size: 16px;
        color: #e74c3c; /* M√†u ƒë·ªè ƒë·ªÉ t·∫°o ƒëi·ªÉm nh·∫•n */
    }

    /* C·∫£i thi·ªán kho·∫£ng c√°ch gi·ªØa c√°c ph·∫ßn t·ª≠ */
    .ml-2 {
        margin-left: 10px;
    }

    /* C·∫£i thi·ªán giao di·ªán c·ªßa c√°c s·ªë li·ªáu */
    #doanhThuNgayNay,
    #doanhThuThangNay,
    #doanhThuNamNay,
    #soLuongSanPhamThangNay,
    #soLuongHoaDonNgayNay,
    #soLuongHoaDonThangNay {
        font-size: 18px;
        font-weight: bold;
        color: #9FEE00; /* M√†u xanh l√° c√¢y cho c√°c gi√° tr·ªã */
    }

    /* C·∫£i thi·ªán v·ªã tr√≠ v√† cƒÉn gi·ªØa */
    .text-center {
        text-align: center;
    }
</style>
<!-- Th√™m m·ªôt s·ªë hi·ªáu ·ª©ng CSS cho ƒë·∫πp h∆°n -->
<body class="hold-transition skin-blue sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">

    <div th:replace="admin/fragments/header :: header"></div>
    <!-- =============================================== -->

    <!-- Left side column. contains the sidebar -->
    <div th:replace="admin/fragments/sidebar :: sidebar"></div>

    <!-- =============================================== -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                Th·ªëng K√™
            </h1>
        </section>

        <!-- Main content -->
        <section class="content">

            <!-- Default box -->
            <div class="box">
                <div class="box-body">
                    <div class="container mt-4">
                        <div class="row">
                            <!-- C·ªôt b√™n tr√°i ch·ª©a c√°c th·∫ª th√¥ng tin (cards) -->
                            <div class="col-md-4">
                                <div class="card text-white bg-primary mb-3">
                                    <div class="card-body">
                                        <h5 class="card-title">Doanh s·ªë th√°ng n√†y</h5>
                                        <p class="display-4" th:text="${soLuongHoaDonThangNay}"></p>
                                        <!-- Hi·ªÉn th·ªã s·ªë l∆∞·ª£ng h√≥a ƒë∆°n -->
                                        <p class="h4" th:if="${doanhSoThangNay == 0}">0 VND</p>
                                        <p class="h4" th:if="${doanhSoThangNay != 0}"
                                           th:text="${#numbers.formatInteger(doanhSoThangNay, 3, 'COMMA') + ' VND'}"></p>

                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="card text-white bg-warning mb-3">
                                    <div class="card-body">
                                        <h5 class="card-title">Doanh s·ªë h√¥m nay</h5>
                                        <p class="display-4" th:text="${soLuongHoaDonNgayNay}"></p>
                                        <!-- Hi·ªÉn th·ªã s·ªë l∆∞·ª£ng h√≥a ƒë∆°n -->
                                        <p class="h4" th:if="${doanhSoNgayNay == 0}">0 VND</p>
                                        <p class="h4" th:if="${doanhSoNgayNay != 0}"
                                           th:text="${#numbers.formatInteger(doanhSoNgayNay, 3, 'COMMA') + ' VND'}"></p>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="card text-white bg-success mb-3">
                                    <div class="card-body">
                                        <h5 class="card-title">S·∫£n ph·∫©m b√°n ƒë∆∞·ª£c trong th√°ng</h5>
                                        <p class="display-4" th:text="${soLuongSanPhamThangNay}"></p>
                                        <!-- T·ªïng s·∫£n ph·∫©m -->
                                        <p class="h4">S·∫£n ph·∫©m</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="container mt-5">
                            <h2 class="text-center mb-4">Bi·ªÉu ƒë·ªì Th·ªëng K√™ B√°n H√†ng</h2>

                            <!-- B·ªô l·ªçc -->
                            <div class="row justify-content-center mb-4">
                                <div class="col-md-10 d-flex justify-content-around">
                                    <button type="button" class="btn btn-outline-primary" id="dayFilter">Ng√†y</button>
                                    <button type="button" class="btn btn-outline-primary" id="sevenDaysFilter">7 Ng√†y
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" id="monthFilter">Th√°ng
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" id="yearFilter">NƒÉm</button>
                                    <button type="button" class="btn btn-outline-primary" id="customFilter">T√πy ch·ªânh
                                    </button>
                                </div>
                                <!-- T√πy ch·ªânh ng√†y (hi·ªÉn th·ªã khi ch·ªçn T√πy ch·ªânh) -->
                                <div class="row justify-content-center text-center" id="customDateRange"
                                     style="display: none;">
                                    <div class="col-md-10 d-flex justify-content-around">
                                        <div class="col-md-6">
                                            <div class="input-group">
                                                <input type="date" id="startDate"
                                                       class="form-control form-control-lg rounded-pill border-0 shadow-sm"
                                                       placeholder="Ng√†y b·∫Øt ƒë·∫ßu">
                                            </div>
                                        </div>
                                        <div class="col-md-2"></div>
                                        <div class="col-md-6">
                                            <div class="input-group">
                                                <input type="date" id="endDate"
                                                       class="form-control form-control-lg rounded-pill border-0 shadow-sm"
                                                       placeholder="Ng√†y k·∫øt th√∫c">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bi·ªÉu ƒë·ªì -->
                            <div class="row justify-content-center mt-5">
                                <div class="col-md-10">
                                    <div class="card shadow-lg border-0 rounded-4">
                                        <div class="card-header text-center bg-gradient-primary text-black rounded-4">
                                            <h4 class="m-1">Bi·ªÉu ƒê·ªì Th·ªëng K√™ B√°n H√†ng</h4>
                                        </div>
                                        <div class="card-body py-4 px-5">
                                            <canvas id="myChart" height="500"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Top s·∫£n ph·∫©m Trong th√°ng -->
                        <div class="container mt-5">
                            <!-- D√≤ng ƒë·∫ßu ti√™n: Top S·∫£n Ph·∫©m B√°n Ch·∫°y v√† Tr·∫°ng Th√°i ƒê∆°n H√†ng -->
                            <div class="row mt-5">
                                <!-- C·ªôt b√™n tr√°i: Top S·∫£n Ph·∫©m B√°n Ch·∫°y -->
                                <div class="col-md-6 border-dark shadow-lg border-0 rounded-4">
                                    <h2 class="text-center">Top S·∫£n Ph·∫©m B√°n Ch·∫°y Trong Th√°ng</h2>
                                    <div id="productsList" class="list-group">
                                        <div class="shadow-lg border-0 rounded-4">
                                            <table id="productTable" class="table table-striped table-bordered">
                                                <thead class="table-dark">
                                                <tr>
                                                    <th scope="col" class="text-center">STT</th>
                                                    <th scope="col" class="text-center">H√¨nh ·∫¢nh</th>
                                                    <th scope="col" class="text-center">T√™n S·∫£n Ph·∫©m</th>
                                                    <th scope="col" class="text-center">Gi√°</th>
                                                    <th scope="col" class="text-center">T·ªïng S·ªë L∆∞·ª£ng B√°n</th>
                                                </tr>
                                                </thead>
                                                <tbody class="text-center">
                                                <tr th:each="product, iterStat : ${productsPage}">
                                                    <td th:text="${iterStat.index + 1}"></td> <!-- STT -->
                                                    <td>
                                                        <img th:src="${product[0]}" alt="H√¨nh ·∫¢nh" width="80">
                                                    </td> <!-- H√¨nh ·∫£nh -->
                                                    <td th:text="${product[1]}"></td> <!-- T√™n s·∫£n ph·∫©m -->
                                                    <td th:text="${#numbers.formatInteger(product[2], 3, 'COMMA') + ' VND'}"></td> <!-- Gi√° s·∫£n ph·∫©m -->
                                                    <td style="color: red; font-weight: bold; font-size: 1.2em;" th:text="${product[4]}"></td> <!-- T·ªïng s·ªë l∆∞·ª£ng b√°n -->
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <!-- C·ªôt b√™n ph·∫£i: Tr·∫°ng Th√°i ƒê∆°n H√†ng -->
                                <div class="col-md-6 border-dark shadow-lg border-0 rounded-4">
                                    <h2 class="text-center">Tr·∫°ng Th√°i ƒê∆°n H√†ng Th√°ng N√†y</h2>
                                    <canvas id="orderStatusChart" class="card shadow-lg border-0 rounded-4"
                                            style="width: 60%; height: 200px;"></canvas>
                                </div>

                            </div>

                            <!-- D√≤ng th·ª© hai: S·∫£n Ph·∫©m S·∫Øp H·∫øt H√†ng v√† T·ªëc ƒê·ªô TƒÉng Tr∆∞·ªüng -->
                            <div class="row mt-5">
                                <!-- C·ªôt b√™n tr√°i: S·∫£n Ph·∫©m S·∫Øp H·∫øt H√†ng -->
                                <div class="col-md border-dark shadow-lg border-0 rounded-4">
                                    <h2 class="text-center">S·∫£n Ph·∫©m S·∫Øp H·∫øt H√†ng</h2>
                                    <div id="lowStockList" class="list-group">
                                        <div class="shadow-lg border-0 rounded-4">
                                            <table id="productTable1" class="table table-striped table-bordered">
                                                <thead class="table-dark">
                                                <tr >
                                                    <th scope="col" class="text-center">STT</th>
                                                    <th scope="col" class="text-center">H√¨nh ·∫¢nh</th>
                                                    <th scope="col" class="text-center">T√™n S·∫£n Ph·∫©m</th>
                                                    <th scope="col" class="text-center">Gi√°</th>
                                                    <th scope="col" class="text-center">C√≤n L·∫°i</th>
                                                </tr>
                                                </thead>
                                                <tbody class="text-center">
                                                <tr th:each="lowStockProduct, iterStat : ${lowStockProducts}">
                                                    <td th:text="${iterStat.index + 1}"></td>
                                                    <td>
                                                        <img th:if="${not #lists.isEmpty(lowStockProduct.hinhAnh)}"
                                                             th:src="${lowStockProduct.hinhAnh[0].urlHinhAnh}"
                                                             alt="H√¨nh ·∫¢nh" width="80">
                                                    </td>
                                                    <td>
                                                        <span th:text="${lowStockProduct.sanPham?.tenSanPham}"></span> -
                                                        <span th:text="${lowStockProduct.mauSac?.tenMauSac}"></span> -
                                                        <span th:text="${lowStockProduct.kichThuoc?.tenKichThuoc}"></span>
                                                        <br> <!-- Xu·ªëng d√≤ng -->
                                                        <div class="progress">
                                                            <div th:classappend="${lowStockProduct.trangThai == 'C√≤n H√†ng' ? 'bg-success' : 'bg-danger'}"
                                                                 th:text="${lowStockProduct.trangThai}"
                                                                 class="progress-bar text-white text-center d-flex align-items-center justify-content-center"
                                                                 style="width: 100%">
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td th:text="${lowStockProduct.gia != null ? #numbers.formatInteger(lowStockProduct.gia, 3, 'COMMA') + ' VND' : 'N/A'}"></td>
                                                    <td style="color: red; font-weight: bold; font-size: 1.2em;"
                                                        th:text="${lowStockProduct.soLuong != null ? lowStockProduct.soLuong : '0'}"></td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <!-- C·ªôt b√™n ph·∫£i: T·ªëc ƒê·ªô TƒÉng Tr∆∞·ªüng C·ª≠a H√†ng -->
                                <div class="col-md-6 border-dark shadow-lg border-0 rounded-4">
                                    <h2 class="text-center mb-4">T·ªëc ƒê·ªô TƒÉng Tr∆∞·ªüng C·ª≠a H√†ng</h2>
                                    <div class="shadow-lg border-0 rounded-4">
                                        <!-- Doanh thu ng√†y -->
                                        <div class="card mb-3 bg-dark text-white">
                                            <div class="card-body d-flex justify-content-between align-items-center">
                                                <span class="font-weight-bold">üìÖ Doanh thu ng√†y</span>
                                                <span id="doanhThuNgayNay" class="growth text-center flex-grow-1">1.000.000 ‚Ç´</span>
                                            </div>
                                        </div>

                                        <!-- Doanh thu th√°ng -->
                                        <div class="card mb-3 bg-dark text-white">
                                            <div class="card-body d-flex justify-content-between align-items-center">
                                                <span class="font-weight-bold">üìÖ Doanh thu th√°ng</span>
                                                <span id="doanhThuThangNay" class="growth text-center flex-grow-1">...</span>
                                            </div>
                                        </div>

                                        <!-- Doanh thu nƒÉm -->
                                        <div class="card mb-3 bg-dark text-white">
                                            <div class="card-body d-flex justify-content-between align-items-center">
                                                <span class="font-weight-bold">üìÖ Doanh thu nƒÉm</span>
                                                <span id="doanhThuNamNay" class="growth text-center flex-grow-1">...</span>
                                            </div>
                                        </div>

                                        <!-- S·∫£n ph·∫©m th√°ng -->
                                        <div class="card mb-3 bg-dark text-white">
                                            <div class="card-body d-flex justify-content-between align-items-center">
                                                <span class="font-weight-bold">üì¶ S·∫£n ph·∫©m th√°ng</span>
                                                <span id="soLuongSanPhamThangNay" class="growth text-center flex-grow-1">...</span>
                                            </div>
                                        </div>

                                        <!-- H√≥a ƒë∆°n ng√†y -->
                                        <div class="card mb-3 bg-dark text-white">
                                            <div class="card-body d-flex justify-content-between align-items-center">
                                                <span class="font-weight-bold">üßæ H√≥a ƒë∆°n ng√†y</span>
                                                <span id="soLuongHoaDonNgayNay" class="growth text-center flex-grow-1">...</span>
                                            </div>
                                        </div>

                                        <!-- H√≥a ƒë∆°n th√°ng -->
                                        <div class="card mb-3 bg-dark text-white">
                                            <div class="card-body d-flex justify-content-between align-items-center">
                                                <span class="font-weight-bold">üßæ H√≥a ƒë∆°n th√°ng</span>
                                                <span id="soLuongHoaDonThangNay" class="growth text-center flex-grow-1">...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <!-- /.box -->

        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    <div th:replace="admin/fragments/footer :: footer"></div>


</div>
<!-- ./wrapper -->

<!-- jQuery 3 -->

<!-- Th√™m c√°c t√†i nguy√™n JavaScript (jQuery, v.v.) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<div th:replace="admin/fragments/script :: script"></div>

<!-- Th√™m Chart.js JS ƒë·ªÉ t·∫°o bi·ªÉu ƒë·ªì -->
<script th:inline="javascript">
    document.addEventListener("DOMContentLoaded", function () {
        // L·∫•y gi√° tr·ªã t·ª´ c√°c thu·ªôc t√≠nh data-value
        const doanhThuNgayNay = /*[[${doanhThuNgayNay}]]*/ 0;
        const doanhThuThangNay = /*[[${doanhThuThangNay}]]*/ 0;
        const doanhThuNamNay = /*[[${doanhThuNamNay}]]*/ 0;
        const soLuongSanPhamThangNay = /*[[${soLuongSanPhamThangNay}]]*/ 0;
        const soLuongHoaDonNgayNay = /*[[${soLuongHoaDonNgayNay}]]*/ 0;
        const soLuongHoaDonThangNay = /*[[${soLuongHoaDonThangNay}]]*/ 0;

        // Hi·ªÉn th·ªã doanh thu
        document.getElementById("doanhThuNgayNay").textContent = formatCurrency(doanhThuNgayNay);
        document.getElementById("doanhThuThangNay").textContent = formatCurrency(doanhThuThangNay);
        document.getElementById("doanhThuNamNay").textContent = formatCurrency(doanhThuNamNay);
        document.getElementById("soLuongSanPhamThangNay").textContent = soLuongSanPhamThangNay + " S·∫£n ph·∫©m";
        document.getElementById("soLuongHoaDonNgayNay").textContent = soLuongHoaDonNgayNay + " H√≥a ƒë∆°n";
        document.getElementById("soLuongHoaDonThangNay").textContent = soLuongHoaDonThangNay + " H√≥a ƒë∆°n";

    });


    // H√†m ƒë·ªãnh d·∫°ng s·ªë ti·ªÅn
    function formatCurrency(amount) {
        return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
    }
</script>

<script th:inline="javascript">
    var labels = /*[[${dates}]]*/ [];
    var salesData = /*[[${salesData}]]*/ [];
    var invoiceData = /*[[${invoiceData}]]*/ [];
    var revenueData = /*[[${revenueData}]]*/ [];

    // Debug d·ªØ li·ªáu g·ªëc
    console.log("D·ªØ li·ªáu g·ªëc - Labels:", labels);
    console.log("Sales Data:", salesData);
    console.log("Invoice Data:", invoiceData);
    console.log("Revenue Data:", revenueData);

    var originalLabels = labels.slice();
    var originalSalesData = salesData.slice();
    var originalInvoiceData = invoiceData.slice();
    var originalRevenueData = revenueData.slice();

    var ctx = document.getElementById('myChart').getContext('2d');

    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'S·ªë l∆∞·ª£ng s·∫£n ph·∫©m b√°n ra',
                data: salesData,
                backgroundColor: 'rgba(54, 162, 235, 0.7)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            var index = context.dataIndex;
                            var product = salesData[index];
                            var invoice = invoiceData[index];
                            var revenue = revenueData[index].toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });

                            return [
                                'S·∫£n ph·∫©m b√°n: ' + product,
                                'S·ªë h√≥a ƒë∆°n: ' + invoice,
                                'Doanh thu: ' + revenue
                            ];
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // H√†m chu·∫©n h√≥a ng√†y (ch·ªâ l·∫•y ng√†y th√°ng nƒÉm)
    function normalizeDate(date) {
        // L√†m tr√≤n xu·ªëng gi·ªù ph√∫t gi√¢y ƒë·ªÉ ch·ªâ l·∫•y ng√†y
        return new Date(date.getFullYear(), date.getMonth(), date.getDate());
    }

    // S·ª± ki·ªán l·ªçc
    document.getElementById('dayFilter').addEventListener('click', function () {
        console.log("B·ªô l·ªçc: H√¥m nay");
        updateChartData('1');
    });

    document.getElementById('sevenDaysFilter').addEventListener('click', function () {
        console.log("B·ªô l·ªçc: 7 ng√†y g·∫ßn nh·∫•t");
        updateChartData('7');
    });

    document.getElementById('monthFilter').addEventListener('click', function () {
        console.log("B·ªô l·ªçc: 1 th√°ng");
        updateChartData('30');
    });

    document.getElementById('yearFilter').addEventListener('click', function () {
        console.log("B·ªô l·ªçc: 1 nƒÉm");
        updateChartData('365');
    });

    document.getElementById('customFilter').addEventListener('click', function () {
        console.log("B·ªô l·ªçc: T√πy ch·ªânh");
        document.getElementById('customDateRange').style.display = 'block';
        updateChartData(); // reset n·∫øu ch∆∞a ch·ªçn ng√†y
    });

    document.getElementById('startDate').addEventListener('change', applyCustomDateFilter);
    document.getElementById('endDate').addEventListener('change', applyCustomDateFilter);

    function applyCustomDateFilter() {
        var startDate = document.getElementById('startDate').value;
        var endDate = document.getElementById('endDate').value;
        console.log("Ng√†y t√πy ch·ªânh:", startDate, "->", endDate);
        if (startDate && endDate) {
            updateChartData(null, startDate, endDate);
        }
    }

    function updateChartData(filterValue, startDate = null, endDate = null) {
        console.log("ƒêang c·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì...");
        var filteredLabels = [];
        var filteredSalesData = [];
        var filteredInvoiceData = [];
        var filteredRevenueData = [];

        // L·∫•y th·ªùi ƒëi·ªÉm hi·ªán t·∫°i v·ªõi th·ªùi gian
        var currentDate = new Date();
        var currentTimestamp = currentDate.getTime(); // Th·ªùi gian t√≠nh theo ms t·ª´ epoch
        var filterDate;

        if (filterValue) {
            switch (filterValue) {
                case '1':  // H√¥m nay
                    filterDate = currentDate;
                    break;
                case '7':  // 7 ng√†y g·∫ßn nh·∫•t
                    filterDate = new Date(currentTimestamp - 7 * 24 * 60 * 60 * 1000); // L·∫•y th·ªùi ƒëi·ªÉm 7 ng√†y tr∆∞·ªõc
                    break;
                case '30':  // 1 th√°ng
                    filterDate = new Date(currentTimestamp - 30 * 24 * 60 * 60 * 1000); // L·∫•y th·ªùi ƒëi·ªÉm 1 th√°ng tr∆∞·ªõc
                    break;
                case '365':  // 1 nƒÉm
                    filterDate = new Date(currentTimestamp - 365 * 24 * 60 * 60 * 1000); // L·∫•y th·ªùi ƒëi·ªÉm 1 nƒÉm tr∆∞·ªõc
                    break;
            }

            console.log("Ng√†y l·ªçc t·ª´:", filterDate);

            // L·ªçc d·ªØ li·ªáu theo ng√†y
            for (var i = 0; i < originalLabels.length; i++) {
                var dateParts = originalLabels[i].split(' - ');
                if (dateParts.length === 3) {
                    var labelDate = new Date(dateParts[2], dateParts[1] - 1, dateParts[0]);
                    labelDate.setHours(0, 0, 0, 0); // L√†m tr√≤n th·ªùi gian cho ch√≠nh x√°c

                    // So s√°nh ng√†y
                    if (labelDate.getTime() >= filterDate.getTime()) {
                        filteredLabels.push(originalLabels[i]);
                        filteredSalesData.push(originalSalesData[i]);
                        filteredInvoiceData.push(originalInvoiceData[i]);
                        filteredRevenueData.push(originalRevenueData[i]);
                    }
                } else {
                    console.warn("L·ªói ƒë·ªãnh d·∫°ng ng√†y:", originalLabels[i]);
                }
            }
        } else if (startDate && endDate) {  // L·ªçc theo ng√†y t√πy ch·ªânh
            var start = new Date(startDate);
            var end = new Date(endDate);
            start.setHours(0, 0, 0, 0); // L√†m tr√≤n xu·ªëng ƒë·∫ßu ng√†y
            end.setHours(23, 59, 59, 999); // L√†m tr√≤n l√™n cu·ªëi ng√†y

            console.log("L·ªçc t·ª´ ng√†y:", start, "ƒë·∫øn ng√†y:", end);

            for (var i = 0; i < originalLabels.length; i++) {
                var dateParts = originalLabels[i].split(' - ');
                if (dateParts.length === 3) {
                    var labelDate = new Date(dateParts[2], dateParts[1] - 1, dateParts[0]);
                    labelDate.setHours(0, 0, 0, 0); // L√†m tr√≤n th·ªùi gian cho ch√≠nh x√°c

                    if (labelDate.getTime() >= start.getTime() && labelDate.getTime() <= end.getTime()) {
                        filteredLabels.push(originalLabels[i]);
                        filteredSalesData.push(originalSalesData[i]);
                        filteredInvoiceData.push(originalInvoiceData[i]);
                        filteredRevenueData.push(originalRevenueData[i]);
                    }
                } else {
                    console.warn("L·ªói ƒë·ªãnh d·∫°ng ng√†y:", originalLabels[i]);
                }
            }
        } else {
            // Kh√¥ng c√≥ filter, reset v·ªÅ to√†n b·ªô
            filteredLabels = originalLabels.slice();
            filteredSalesData = originalSalesData.slice();
            filteredInvoiceData = originalInvoiceData.slice();
            filteredRevenueData = originalRevenueData.slice();
            console.log("Reset bi·ªÉu ƒë·ªì v·ªÅ d·ªØ li·ªáu g·ªëc");
        }

        console.log("D·ªØ li·ªáu sau l·ªçc:");
        console.log("Labels:", filteredLabels);
        console.log("Sales:", filteredSalesData);
        console.log("Invoices:", filteredInvoiceData);
        console.log("Revenue:", filteredRevenueData);

        // C·∫≠p nh·∫≠t d·ªØ li·ªáu cho bi·ªÉu ƒë·ªì
        myChart.data.labels = filteredLabels;
        myChart.data.datasets[0].data = filteredSalesData;
        myChart.update();
    }
</script>

<script th:inline="javascript">
    /*<![CDATA[*/
    var processingPercentage = [[${processingPercentage}]];
    var waitingConfirmationPercentage = [[${waitingConfirmationPercentage}]];
    var confirmedPercentage = [[${confirmedPercentage}]];
    var waitingDeliveryPercentage = [[${waitingDeliveryPercentage}]];
    var paidPercentage = [[${paidPercentage}]];
    var finishedPercentage = [[${finishedPercentage}]];
    var cancelledPercentage = [[${cancelledPercentage}]];
    var failedPercentage = [[${failedPercentage}]];

    var ctx = document.getElementById('orderStatusChart').getContext('2d');

    var orderStatusChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['ƒêang X·ª≠ L√Ω', 'Ch·ªù X√°c Nh·∫≠n', 'ƒê√£ X√°c Nh·∫≠n', 'Ch·ªù V·∫≠n Chuy·ªÉn',
                'ƒê√£ Thanh To√°n', 'ƒê√£ Ho√†n Th√†nh', 'ƒê√£ H·ªßy', 'Ho√†n Tr·∫£'],
            datasets: [{
                label: 'Tr·∫°ng Th√°i ƒê∆°n H√†ng',
                data: [
                    processingPercentage,
                    waitingConfirmationPercentage,
                    confirmedPercentage,
                    waitingDeliveryPercentage,
                    paidPercentage,
                    finishedPercentage,
                    cancelledPercentage,
                    failedPercentage
                ],
                backgroundColor: ['#28a745', '#ffc107', '#17a2b8', '#ffc0cb', '#007bff', '#8e44ad', '#f39c12', '#d35400'],
                borderColor: ['#218838', '#e0a800', '#138496', '#e0a0a0', '#0056b3', '#6c3483', '#d68910', '#b03a2e'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    callbacks: {
                        label: function (tooltipItem) {
                            return tooltipItem.label + ': ' + tooltipItem.raw + '%';
                        }
                    }
                }
            }
        }
    });
    /*]]>*/
</script>

<!--Load table-->
<script>
    $(document).ready(function () {
        function initializeDataTable(tableId) {
            $(tableId).DataTable({
                "paging": true,
                "lengthMenu": [3, 5, 7, 9, 10, 20],
                "pageLength": 3,
                "autoWidth": false,
                "responsive": true,
                "language": {
                    "sProcessing": "ƒêang x·ª≠ l√Ω...",
                    "sLengthMenu": "Hi·ªÉn th·ªã _MENU_ d√≤ng",
                    "sZeroRecords": "Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu",
                    "sInfo": "Hi·ªÉn th·ªã _START_ ƒë·∫øn _END_ trong t·ªïng _TOTAL_ d√≤ng",
                    "sInfoEmpty": "Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã",
                    "sInfoFiltered": "(l·ªçc t·ª´ _MAX_ d√≤ng)",
                    "sSearch": "T√¨m ki·∫øm:",
                    "oPaginate": {
                        "sFirst": "ƒê·∫ßu",
                        "sPrevious": "Tr∆∞·ªõc",
                        "sNext": "Ti·∫øp",
                        "sLast": "Cu·ªëi"
                    }
                }
            });
        }

        // Kh·ªüi t·∫°o DataTable cho c·∫£ hai b·∫£ng
        initializeDataTable('#productTable');
        initializeDataTable('#productTable1');
    });

</script>

<script src="/js/main.js"></script>
<script src="/js/DangNhap/login.js"></script>
<script src="/js/DangNhap/logout.js"></script>
</body>
</html>
