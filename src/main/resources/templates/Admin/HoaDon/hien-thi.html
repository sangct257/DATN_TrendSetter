<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="admin/fragments/head :: head"></head>
<body class="hold-transition skin-blue sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">

    <div th:replace="admin/fragments/header :: header"></div>
    <!-- =============================================== -->

    <!-- Left side column. contains the sidebar -->
    <div th:replace="admin/fragments/sidebar :: sidebar"></div>

    <!-- =============================================== -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                Danh sách hóa đơn
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
                <li><a href="#">Examples</a></li>
                <li class="active">Blank page</li>
            </ol>
        </section>

        <!-- Main content -->
        <section class="content">
            <div class="box">
                <div class="border p-3">
                    <div class="border p-3">
                        <div class="row mb-3">
                            <div class="col">
                                <div class="d-flex flex-nowrap overflow-auto gap-2">
                                    <button class="btn btn-outline-secondary filter-btn active" data-status="">Tất cả</button>
                                    <button class="btn btn-outline-warning filter-btn" data-status="Đang Xử Lý">Đang Xử Lý</button>
                                    <button class="btn btn-outline-primary filter-btn" data-status="Chờ Xác Nhận">Chờ Xác Nhận</button>
                                    <button class="btn btn-outline-info filter-btn" data-status="Đã Xác Nhận">Đã Xác Nhận</button>
                                    <button class="btn btn-outline-secondary filter-btn" data-status="Chờ Vận Chuyển">Chờ Vận Chuyển</button>
                                    <button class="btn btn-outline-success filter-btn" data-status="Đã Thanh Toán">Đã Thanh Toán</button>
                                    <button class="btn btn-outline-success filter-btn" data-status="Đã Hoàn Thành">Đã Hoàn Thành</button>
                                    <button class="btn btn-outline-danger filter-btn" data-status="Hoàn Trả">Hoàn Trả</button>
                                    <button class="btn btn-outline-dark filter-btn" data-status="Đã Hủy">Đã Hủy</button>
                                </div>
                            </div>
                        </div>



                        <div class="table-responsive">
                            <table id="productTable" class="table table-striped table-bordered">
                                <thead class="table-dark">
                                <tr>
                                    <th class="text-center">#</th>
                                    <th class="text-center">Mã Hóa Đơn</th>
                                    <th class="text-center">Khách Hàng</th>
                                    <th class="text-center">Nhân Viên</th>
                                    <th class="text-center">Tổng Tiền</th>
                                    <th class="text-center">Ngày</th>
                                    <th class="text-center">Trạng Thái</th>
                                    <th class="text-center">Action</th>
                                </tr>
                                </thead>
                                <tbody class="text-center">
                                <tr th:each="hoaDon, status : ${hoaDon}">
                                    <td th:text="${status.index + 1}"></td>
                                    <td th:text="${hoaDon.maHoaDon}"></td>
                                    <td th:text="${hoaDon.khachHang != null ? hoaDon.khachHang.hoTen : ''}"></td>
                                    <td th:text="${hoaDon.nhanVien != null ? hoaDon.nhanVien.hoTen : ''}"></td>
                                    <td th:text="${hoaDon.tongTien}"></td>
                                    <td>Ngày Tạo : <span th:text="${hoaDon.ngayTao}"></span><br>Ngày Sửa : <span th:text="${hoaDon.ngaySua}"></span></td>
                                    <td>
                                        <button class="btn"
                                                th:classappend="${statusClasses[hoaDon.trangThai] ?: 'btn-info'}"
                                                th:text="${hoaDon.trangThai}">
                                        </button>
                                    </td>
                                    <td>
                                        <a th:href="@{'/admin/order-details?hoaDonId=' + ${hoaDon.id}}" class="btn btn-warning btn-sm">
                                            <i class="bi bi-pencil-square"></i> Chi Tiết
                                        </a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    <div th:replace="admin/fragments/footer :: footer"></div>


</div>
<!-- ./wrapper -->

<!-- jQuery 3 -->

<div th:replace="admin/fragments/script :: script"></div>
<!--     lọc trạng thái-->
<script>
    document.getElementById("statusFilter").addEventListener("change", function () {
        let selectedStatus = this.value.trim(); // Không đổi thành lowercase
        let rows = document.querySelectorAll("table tbody tr");

        rows.forEach(row => {
            let statusCell = row.querySelector("td:nth-child(8)"); // Cột trạng thái
            if (statusCell) {
                let statusText = statusCell.textContent.trim(); // Không đổi lowercase
                if (selectedStatus === "" || statusText === selectedStatus) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
                console.log("Trạng thái trong bảng:", statusText);
                console.log("Trạng thái được chọn:", selectedStatus);
            }
        });
    });

</script>

<!--Load table-->
<script>
    $(document).ready(function () {
        $('#productTable').DataTable({
            "paging": true,
            "lengthMenu": [5, 10, 20],
            "pageLength": 5,
            "autoWidth": false,
            "responsive": true,
            "language": {
                "sProcessing": "Đang xử lý...",
                "sLengthMenu": "Hiển thị _MENU_ dòng",
                "sZeroRecords": "Không tìm thấy dữ liệu",
                "sInfo": "Hiển thị _START_ đến _END_ trong tổng _TOTAL_ dòng",
                "sInfoEmpty": "Không có dữ liệu để hiển thị",
                "sInfoFiltered": "(lọc từ _MAX_ dòng)",
                "sSearch": "Tìm kiếm:",
                "oPaginate": {
                    "sFirst": "Đầu",
                    "sPrevious": "Trước",
                    "sNext": "Tiếp",
                    "sLast": "Cuối"
                }
            }
        });
    });
</script>

</body>
</html>
