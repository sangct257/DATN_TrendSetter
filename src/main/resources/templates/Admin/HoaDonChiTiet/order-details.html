<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="admin/fragments/head :: head"></head>
<style>
    body {
        background-color: #f8f9fa;
        font-family: Arial, sans-serif;
    }


    .timeline {
        display: flex;
        justify-content: flex-start;
        align-items: center;
        text-align: center;
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        position: relative;
        overflow-x: auto;
        scroll-behavior: smooth;
        white-space: nowrap;
    }

    .timeline .step {
        flex: 0 0 auto;
        width: 120px;
        margin: 0 10px;
        position: relative;
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 1s forwards;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .timeline .step .icon {
        width: 50px;
        height: 50px;
        background-color: #D19C97;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 5px;
        font-size: 20px;
        transition: transform 0.3s, background-color 0.3s;
    }

    .timeline .step:hover .icon {
        transform: scale(1.2);
        background-color: #0056b3;
    }

    .timeline .step:hover .icon {
        transform: scale(1.2);
        background-color: #0056b3;
    }

    /* Active step icon */
    .timeline .step.active .icon {
        background-color: #28a745;
        transform: scale(1.2);
    }

    /* Arrow styles */
    .timeline .step::after {
        content: '\2192'; /* Right arrow */
        font-size: 20px;
        color: #D19C97;
        position: absolute;
        top: 50%;
        right: -20px;
        transform: translateY(-50%);
        opacity: 1;
        animation: fadeIn 0.5s forwards;
    }

    .timeline .step:last-child::after {
        content: '';
    }

    /* Styles for the button */
    .btn-warning {
        display: block;
        margin: 20px auto;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        background-color: #D19C97;
        color: white;
        border: none;
        transition: background-color 0.3s;
    }

    .btn-warning:hover {
        background-color: #171615;
    }

    /* L·ªãch s·ª≠ thanh to√°n */
    .payment-history {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-top: 20px;
    }

    /* B·∫£ng l·ªãch s·ª≠ */
    .table thead {
        background-color: #171615;
        color: white;
    }

    /* C·∫£i thi·ªán n√∫t */
    .btn-primary {
        background-color: #007bff;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        transition: background-color 0.3s;
    }

    .btn-primary:hover {
        background-color: #0056b3;
    }

    .btn-success {
        background-color: #28a745;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        transition: background-color 0.3s;
    }

    .btn-success:hover {
        background-color: #1e7e34;
    }

    .btn-danger {
        background-color: #9f191f;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        transition: background-color 0.3s;
    }

    .btn-danger:hover {
        background-color: #9f191f;
    }
    .progress-bar {
        transition: width 0.4s ease; /* Th√™m hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªông cho thanh ti·∫øn tr√¨nh */
    }

</style>
<body class="hold-transition skin-blue sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">

    <div th:replace="admin/fragments/header :: header"></div>
    <!-- =============================================== -->

    <!-- Left side column. contains the sidebar -->
    <div th:replace="admin/fragments/sidebar :: sidebar"></div>

    <!-- =============================================== -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                Blank page
                <small>it all starts here</small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
                <li><a href="#">Examples</a></li>
                <li class="active">Blank page</li>
            </ol>
            <!-- Toast Notification -->
            <!-- Toast Th√¥ng B√°o -->
            <div class="toast-container position-fixed top-0 end-0 p-3">
                <div id="toast-message" class="toast align-items-center text-bg-primary border-0 fade hide" role="alert"
                     aria-live="assertive" aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body">
                            <span id="toast-text">ƒêang t·∫°o h√≥a ƒë∆°n, vui l√≤ng ch·ªù...</span>
                            <div id="toast-loading-bar" class="progress mt-2">
                                <div class="progress-bar progress-bar-striped progress-bar-animated bg-light"
                                     style="width: 0%;"></div>
                            </div>
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                                aria-label="Close"></button>
                    </div>
                </div>
            </div>

        </section>

        <!-- Main content -->
        <section class="content">

            <!-- Default box -->
            <div class="box">
                <div class="box-body">
                    <div class="container">
                        <section class="mt-4">
                            <div class="timeline">
                                <th:block th:each="lichSu : ${listLichSuHoaDon}">
                                    <div class="step">
                                        <div class="icon" th:text="${lichSu.hanhDong == 'ƒêang X·ª≠ L√Ω' ? '‚úçÔ∏è' :
                   (lichSu.hanhDong == 'Ch·ªù X√°c Nh·∫≠n' ? '‚è≥' :
                   (lichSu.hanhDong == 'ƒê√£ X√°c Nh·∫≠n' ? '‚úÖ' :
                   (lichSu.hanhDong == 'Ch·ªù V·∫≠n Chuy·ªÉn' ? 'üì¶' :
                   (lichSu.hanhDong == 'ƒêang Giao H√†ng' ? 'üöö' :
                   (lichSu.hanhDong == 'ƒê√£ Giao H√†ng' ? 'üì¨' :
                   (lichSu.hanhDong == 'ƒê√£ Thanh To√°n' ? 'üí≥' :
                   (lichSu.hanhDong == 'ƒê√£ Ho√†n Th√†nh' ? 'üéâ' :
                   (lichSu.hanhDong == 'ƒê√£ H·ªßy' ? '‚ùå' :
                   (lichSu.hanhDong == 'Ho√†n Tr·∫£/Ho√†n Ti·ªÅn' ? 'üîÑ' : '‚ùì')))))))))}">
                                        </div>
                                        <p th:text="${lichSu.hanhDong}"></p>
                                        <small th:text="${#temporals.format(lichSu.ngayTao, 'HH:mm:ss dd-MM-yyyy')}"></small>
                                    </div>
                                </th:block>
                            </div>

                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <div class="d-flex gap-2">
                                    <!-- N√∫t X√°c Nh·∫≠n -->
                                    <button type="button" class="btn btn-warning"
                                            th:if="${!listLichSuHoaDon.isEmpty() and listLichSuHoaDon[__${listLichSuHoaDon.size() - 1}__].hanhDong == 'Ch·ªù X√°c Nh·∫≠n'}"
                                            th:attr="data-hoaDonId=${hoaDon.id}, data-apiEndpoint='/api/v2/xac-nhan'"
                                            onclick="moModalXacNhanChung(this, 'xacNhanChungModal')">
                                        X√°c Nh·∫≠n
                                    </button>

                                    <!-- N√∫t V·∫≠n Chuy·ªÉn -->
                                    <button type="button" class="btn btn-warning"
                                            th:if="${!listLichSuHoaDon.isEmpty() and listLichSuHoaDon[__${listLichSuHoaDon.size() - 1}__].hanhDong == 'ƒê√£ X√°c Nh·∫≠n'}"
                                            th:attr="data-hoaDonId=${hoaDon.id}, data-apiEndpoint='/api/v2/van-chuyen'"
                                            onclick="moModalXacNhanChung(this, 'xacNhanChungModal')">
                                        V·∫≠n Chuy·ªÉn
                                    </button>
                                    <button type="button" class="btn btn-warning"
                                            th:if="${!listLichSuHoaDon.isEmpty() and listLichSuHoaDon[__${listLichSuHoaDon.size() - 1}__].hanhDong == 'Ch·ªù V·∫≠n Chuy·ªÉn'}"
                                            th:attr="data-hoaDonId=${hoaDon.id}, data-apiEndpoint='/api/v2/giao-hang'"
                                            onclick="moModalXacNhanChung(this, 'xacNhanChungModal')">
                                        Giao H√†ng
                                    </button>

                                    <button type="submit" class="btn btn-warning"
                                            th:if="${!listLichSuHoaDon.isEmpty() and listLichSuHoaDon[__${listLichSuHoaDon.size() - 1}__].hanhDong == 'ƒêang Giao H√†ng'}"
                                            th:attr="data-hoaDonId=${hoaDon.id}, data-apiEndpoint='/api/v2/xac-nhan-giao-hang'"
                                            onclick="moModalXacNhanChung(this, 'xacNhanChungModal')">
                                        X√°c Nh·∫≠n Giao H√†ng
                                    </button>

                                    <button type="submit" class="btn btn-warning"
                                            th:if="${!listLichSuHoaDon.isEmpty() and listLichSuHoaDon[__${listLichSuHoaDon.size() - 1}__].hanhDong == 'ƒê√£ Giao H√†ng'}"
                                            th:attr="data-hoaDonId=${hoaDon.id}, data-apiEndpoint='/api/v2/xac-nhan-thanh-toan'"
                                            onclick="moModalXacNhanChung(this, 'xacNhanChungModal')">
                                        X√°c Nh·∫≠n Thanh To√°n
                                    </button>

                                    <button type="submit" class="btn btn-warning"
                                            th:if="${!listLichSuHoaDon.isEmpty() and listLichSuHoaDon[__${listLichSuHoaDon.size() - 1}__].hanhDong == 'ƒê√£ Thanh To√°n'}"
                                            th:attr="data-hoaDonId=${hoaDon.id}, data-apiEndpoint='/api/v2/xac-nhan-hoan-thanh'"
                                            onclick="moModalXacNhanChung(this, 'xacNhanChungModal')">
                                        X√°c Nh·∫≠n Ho√†n Th√†nh
                                    </button>

                                    <button type="submit" class="btn btn-warning"
                                            th:if="${!listLichSuHoaDon.isEmpty() and listLichSuHoaDon[__${listLichSuHoaDon.size() - 1}__].hanhDong == 'ƒêang Giao H√†ng'}"
                                            th:attr="data-hoaDonId=${hoaDon.id}, data-apiEndpoint='/api/v2/huy'"
                                            onclick="moModalXacNhanChung(this, 'xacNhanChungModal')">
                                        H·ªßy
                                    </button>

                                    <button type="submit" class="btn btn-warning"
                                            th:if="${listLichSuHoaDon[listLichSuHoaDon.size() - 1].hanhDong != 'ƒêang X·ª≠ L√Ω'
                                                and listLichSuHoaDon[listLichSuHoaDon.size() - 1].hanhDong != 'Ch·ªù X√°c Nh·∫≠n'}"
                                            th:attr="data-hoaDonId=${hoaDon.id}, data-apiEndpoint='/api/v2/quay-lai'"
                                            onclick="moModalXacNhanChung(this, 'xacNhanChungModal')">
                                        Quay L·∫°i
                                    </button>

                                    <!-- Modal D√πng Chung -->
                                    <div class="modal fade" id="xacNhanChungModal" tabindex="-1"
                                         aria-labelledby="xacNhanChungModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="xacNhanChungModalLabel">X√°c nh·∫≠n thao
                                                        t√°c</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën th·ª±c hi·ªán thao t√°c n√†y kh√¥ng?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">H·ªßy
                                                    </button>
                                                    <button type="button" class="btn btn-primary" id="btnXacNhanChung">
                                                        X√°c Nh·∫≠n
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- N√∫t Quay l·∫°i ch·ªâ xu·∫•t hi·ªán khi c√≥ √≠t nh·∫•t 3 ph·∫ßn t·ª≠ trong danh s√°ch -->
                                </div>
                            </div>
                        </section>

                        <section class="mt-4">
                            <div class="payment-history">
                                <h3 class="mb-3">L·ªãch s·ª≠ thanh to√°n</h3>
                                <table class="table table-bordered text-center">
                                    <thead>
                                    <tr>
                                        <th>STT</th>
                                        <th>M√£ giao d·ªãch</th>
                                        <th>S·ªë ti·ªÅn</th>
                                        <th>Th·ªùi gian</th>
                                        <th>Lo·∫°i giao d·ªãch</th>
                                        <th>Ph∆∞∆°ng th·ª©c thanh to√°n</th>
                                        <th>Ghi ch√∫</th>
                                        <th>Ng∆∞·ªùi x√°c nh·∫≠n</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <th:block th:each="hoaDon,status : ${hoaDon}">
                                        <tr>
                                            <td th:text="${status.index+1}"></td>
                                            <td th:text="${hoaDon.maHoaDon}"></td>
                                            <td>
                                                <small class="text-danger font-weight-bold fs-5"
                                                       th:text="${#numbers.formatInteger(hoaDon.tongTien, 3, 'COMMA') + ' VND'}"></small>
                                            </td>
                                            <td th:text="${#temporals.format(hoaDon.ngayTao, 'HH:mm:ss dd-MM-yyyy')}"></td>
                                            <td>
                                                <button th:classappend="${hoaDon.loaiGiaoDich == 'Tr·∫£ Sau' ? 'btn-secondary' : 'btn-success'}"
                                                        class="btn">
                                                    <span th:text="${hoaDon.loaiGiaoDich}"></span>
                                                </button>

                                            </td>
                                            <td>
                                                <button class="btn btn-success"><span
                                                        th:text="${hoaDon.phuongThucThanhToan.tenPhuongThuc}"></span>
                                                </button>
                                            </td>
                                            <td th:text="${hoaDon.ghiChu}"></td>
                                            <td th:text="${hoaDon.nhanVien != null ? hoaDon.nhanVien.hoTen : ''}"></td>
                                        </tr>
                                    </th:block>
                                    </tbody>
                                </table>
                            </div>
                        </section>

                        <section class="mt-4 p-4 border rounded bg-light shadow-sm">
                            <div class="row align-items-center mb-3">
                                <div class="col-md-6">
                                    <h4 class="mb-0">
                                        <strong>Th√¥ng tin ƒë∆°n h√†ng: </strong>
                                        <span class="text-primary" th:text="${hoaDon.maHoaDon}"></span>
                                    </h4>
                                </div>
                                <div class="col-md-6 text-end">
                                    <button class="btn btn-white border-dark"
                                            th:attr="disabled=${hoaDon.trangThai != 'Ch·ªù X√°c Nh·∫≠n'}"
                                            data-bs-toggle="modal"
                                            data-bs-target="#changeOrderModal">
                                        Thay ƒê·ªïi
                                    </button>
                                </div>
                                <!-- Modal -->
                                <div class="modal fade" id="changeOrderModal" tabindex="-1"
                                     aria-labelledby="changeOrderLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="changeOrderLabel">Ch·ªânh s·ª≠a ƒë∆°n h√†ng</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                            </div>
                                            <form id="updateShippingForm">
                                                <input type="hidden" name="hoaDonId" th:value="${hoaDon.id}">
                                                <div class="row">
                                                    <div class="col-md-12 mb-3">
                                                        <input type="text" name="nguoiNhan" class="form-control w-100"
                                                               id="shippingNguoiNhan"
                                                               th:value="${hoaDon.nguoiNhan != null ? hoaDon.nguoiNhan : ''}"
                                                               th:disabled="${hoaDon.khachHang != null}">
                                                        <input type="hidden"
                                                               th:value="${hoaDon.nguoiNhan}">
                                                        <span class="text-danger" id="shippingNguoiNhanError"></span>
                                                    </div>

                                                    <div class="col-md-12 mb-3">
                                                        <input type="text" name="soDienThoai" class="form-control w-100"
                                                               id="shippingSoDienThoai"
                                                               th:value="${hoaDon.soDienThoai != null ? hoaDon.soDienThoai : ''}"
                                                               th:disabled="${hoaDon.khachHang != null}">
                                                        <input type="hidden"
                                                               th:value="${hoaDon.soDienThoai }">
                                                        <span class="text-danger" id="shippingSoDienThoaiError"></span>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <input type="text" id="soNha" name="soNha"
                                                                   class="form-control"
                                                                   th:value="${hoaDon.soNha}" placeholder="S·ªë nh√†">
                                                            <span class="text-danger" id="soNhaError"></span>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <input type="text" id="tenDuong" name="tenDuong"
                                                                   class="form-control" th:value="${hoaDon.tenDuong}"
                                                                   placeholder="T√™n ƒë∆∞·ªùng">
                                                            <span class="text-danger" id="tenDuongError"></span>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-4 mb-3">
                                                            <select id="thanhPho" name="thanhPho" class="form-control">
                                                                <option th:value="${hoaDon.thanhPho != null ? hoaDon.thanhPho : ''}"
                                                                        th:text="${hoaDon.thanhPho != null ? hoaDon.thanhPho : 'Ch·ªçn T·ªânh/Th√†nh ph·ªë'}"></option>
                                                            </select>
                                                            <input type="hidden" id="thanhPhoHidden"
                                                                   th:value="${hoaDon.thanhPho}">
                                                            <span class="text-danger" id="thanhPhoError"></span>
                                                        </div>

                                                        <div class="col-md-4 mb-3">
                                                            <select id="huyen" name="huyen" class="form-control">
                                                                <option th:value="${hoaDon.huyen != null ? hoaDon.huyen : ''}"
                                                                        th:text="${hoaDon.huyen != null ? hoaDon.huyen : 'Ch·ªçn Qu·∫≠n/Huy·ªán'}"></option>
                                                            </select>
                                                            <input type="hidden" id="huyenHidden"
                                                                   th:value="${hoaDon.huyen}">
                                                            <span class="text-danger" id="huyenError"></span>
                                                        </div>

                                                        <div class="col-md-4 mb-3">
                                                            <select id="phuong" name="phuong" class="form-control">
                                                                <option th:value="${hoaDon.phuong != null ? hoaDon.phuong : ''}"
                                                                        th:text="${hoaDon.phuong != null ? hoaDon.phuong : 'Ch·ªçn Ph∆∞·ªùng/X√£'}"></option>
                                                            </select>
                                                            <input type="hidden" id="phuongHidden"
                                                                   th:value="${hoaDon.phuong}">
                                                            <span class="text-danger" id="phuongError"></span>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
            <textarea id="ghiChu" placeholder="Nh·∫≠p ghi ch√∫ n·∫øu c√≥"
                      name="ghiChu" class="form-control"
                      rows="3" th:text="${hoaDon.ghiChu}"></textarea>
                                                    </div>
                                                </div>

                                                <button type="submit" class="btn btn-primary w-100">C·∫≠p nh·∫≠t giao h√†ng
                                                </button>
                                            </form>
                                        </div>

                                    </div>
                                </div>

                            </div>

                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0">Th√¥ng Tin H√≥a ƒê∆°n</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <!-- C·ªôt tr√°i -->
                                        <div class="col-md-6">
                                            <div class="row mb-3">
                                                <label class="col-md-5 fw-bold">Tr·∫°ng th√°i:</label>
                                                <div class="col-md-3">
                                                    <span class="badge bg-primary p-2 w-100 text-center"
                                                          th:text="${hoaDon.trangThai}"></span>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <label class="col-md-5 fw-bold">Lo·∫°i H√≥a ƒê∆°n:</label>
                                                <div class="col-md-3">
                                                    <span class="badge bg-secondary p-2 w-100 text-center"
                                                          th:text="${hoaDon.loaiHoaDon}"></span>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <label class="col-md-5 fw-bold">ƒê·ªãa ch·ªâ:</label>
                                                <div class="col-md-6">
                                                    <span th:if="${hoaDon.soNha != null}"
                                                          th:text="${hoaDon.soNha + ', '}"></span>
                                                    <span th:if="${hoaDon.phuong != null}"
                                                          th:text="${hoaDon.phuong + ', '}"></span>
                                                    <span th:if="${hoaDon.huyen != null}"
                                                          th:text="${hoaDon.huyen + ', '}"></span>
                                                    <span th:if="${hoaDon.thanhPho != null}"
                                                          th:text="${hoaDon.thanhPho}"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- C·ªôt ph·∫£i -->
                                        <div class="col-md-6">
                                            <div class="row mb-3">
                                                <label class="col-md-5 fw-bold">T√™n kh√°ch h√†ng:</label>
                                                <div class="col-md-3">
                                                    <span class="badge bg-info p-2 w-100 text-dark text-center"
                                                          th:text="${hoaDon.nguoiNhan}"></span>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <label class="col-md-5 fw-bold">S·ªë ƒêi·ªán Tho·∫°i:</label>
                                                <div class="col-md-3">
                                                    <span class="badge bg-warning p-2 w-100 text-dark text-center"
                                                          th:text="${hoaDon.soDienThoai}"></span>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <label class="col-md-5 fw-bold">Th·ªùi gian d·ª± ki·∫øn nh·∫≠n:</label>
                                                <div class="col-md-5">
                                                    <span class="badge bg-success p-2 w-100 text-center"
                                                          th:text="${hoaDon.thoiGianNhanDuKien}"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Ghi ch√∫ -->
                                        <div class="mt-3">
                                            <p><strong>Ghi ch√∫: </strong>
                                                <span class="badge bg-dark p-2" th:text="${hoaDon.ghiChu}"></span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section class="mt-4">
                            <div class="bg-white p-3 shadow rounded">
                                <div class="row align-items-center mb-3">
                                    <div class="col-md-6">
                                        <h3 class="mb-3">Th√¥ng tin s·∫£n ph·∫©m ƒë√£ mua</h3>
                                    </div>
                                    <div class="col-md-6 text-end">
                                        <button class="btn btn-light"
                                                th:attr="disabled=${hoaDon.trangThai != 'Ch·ªù X√°c Nh·∫≠n' ? 'disabled' : null}">
                                            <a class="btn btn-light" data-bs-toggle="modal"
                                               data-bs-target="#addProductModal">
                                                <i class="fas fa-cart-plus"></i> Th√™m s·∫£n ph·∫©m
                                            </a>
                                        </button>

                                        <div class="modal fade" id="addProductModal" tabindex="-1"
                                             aria-labelledby="addProductModalLabel" aria-hidden="true">
                                            <div class="modal-dialog modal-xl">
                                                <div class="modal-content" style="border: 2px solid">
                                                    <div class="modal-header bg-primary text-white">
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                                aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <form id="orderForm">
                                                            <input type="hidden" name="hoaDonId"
                                                                   th:value="${hoaDon.id}">
                                                            <div class="product-list"
                                                                 style="border-top: 2px solid; padding-top: 20px;">
                                                                <!-- B·∫£ng s·∫£n ph·∫©m cƒÉn ch·ªânh ƒë·∫πp h∆°n -->
                                                                <div class="table-responsive">
                                                                    <table id="productTable"
                                                                           class="table table-striped table-bordered">
                                                                        <thead class="table-dark">
                                                                        <tr class="text-center">
                                                                            <th class="text-center">#</th>
                                                                            <th class="text-center">H√¨nh ·∫¢nh</th>
                                                                            <th class="text-center">Th√¥ng Tin S·∫£n Ph·∫©m</th>
                                                                            <th class="text-center">S·ªë L∆∞·ª£ng</th>
                                                                            <th class="text-center">Gi√°</th>
                                                                            <th class="text-center">Tr·∫°ng Th√°i</th>
                                                                            <th class="text-center">Ch·ªçn</th>
                                                                        </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                        <tr th:each="sanPhamChiTiet, status : ${sanPhamChiTiet}">
                                                                            <td th:text="${status.index + 1}"
                                                                                class="text-center"></td>
                                                                            <td class="text-center">
                                                                                <img th:src="@{${'/images/'+sanPhamChiTiet.hinhAnh[0].urlHinhAnh}}"
                                                                                     class="rounded border shadow-sm"
                                                                                     style="width: 70px; height: 70px; object-fit: cover;">
                                                                            </td>
                                                                            <td class="text-center">
                                                                                <strong class="text-primary d-inline-block"
                                                                                        th:text="${sanPhamChiTiet.sanPham.tenSanPham}"></strong>
                                                                                (<span
                                                                                    th:text="${sanPhamChiTiet.mauSac.tenMauSac}"></span>
                                                                                -
                                                                                <span th:text="${sanPhamChiTiet.kichThuoc.tenKichThuoc}"></span>)
                                                                            </td>
                                                                            <td class="text-center">
                                                                                <input type="number" name="soLuong"
                                                                                       value="1" min="1"
                                                                                       th:max="${sanPhamChiTiet.soLuong}"
                                                                                       class="form-control form-control-sm text-center">
                                                                            </td>
                                                                            <td class="fw-bold text-danger text-center">
                                                                                <span th:text="${#numbers.formatDecimal(sanPhamChiTiet.gia, 0, 'COMMA', 0, 'POINT') + ' VND'}"></span>
                                                                            </td>
                                                                            <td class="text-center">
                                                                                <button th:class="${sanPhamChiTiet.trangThai == 'C√≤n H√†ng' ? 'badge bg-success' : 'badge bg-danger'}"
                                                                                        th:text="${sanPhamChiTiet.trangThai}">
                                                                                </button>
                                                                            </td>
                                                                            <td class="text-center">
                                                                                <button type="button"
                                                                                        class="btn btn-outline-primary btn-sm fw-bold"
                                                                                        onclick="addProductOrder(this)">
                                                                                    <i class="bi bi-cart-plus"></i> Ch·ªçn
                                                                                </button>
                                                                            </td>
                                                                        </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <table class="table table-bordered">
                                    <thead class="table-warning text-center">
                                    <tr>
                                        <th style="width: 5%">STT</th>
                                        <th style="width: 15%">·∫¢nh S·∫£n Ph·∫©m</th>
                                        <th style="width: 20%">Th√¥ng Tin S·∫£n Ph·∫©m</th>
                                        <th style="width: 10%">M√†u S·∫Øc</th>
                                        <th style="width: 10%">S·ªë L∆∞·ª£ng</th>
                                        <th style="width: 15%">T·ªïng Ti·ªÅn</th>
                                        <th style="width: 10%">Tr·∫°ng Th√°i</th>
                                        <th style="width: 10%">Ch·ª©c NƒÉng</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <th:block th:each="hoaDonChiTiet,status : ${danhSachHoaDonChiTiet}">
                                        <tr>
                                            <td th:text="${status.index+1}" class="text-center"></td>
                                            <td class="text-center">
                                                <img th:src="@{'/images/' + ${hoaDonChiTiet.sanPhamChiTiet.hinhAnh[0].urlHinhAnh}}"
                                                     width="80">
                                            </td>
                                            <td><strong
                                                    th:text="${hoaDonChiTiet.sanPhamChiTiet.sanPham.tenSanPham}"></strong><br>
                                                <small th:text="'Size: ' + ${hoaDonChiTiet.sanPhamChiTiet.kichThuoc.tenKichThuoc}"></small><br>
                                                <small class="text-danger font-weight-bold fs-5"
                                                       th:text="${#numbers.formatInteger(hoaDonChiTiet.sanPhamChiTiet.gia, 3, 'COMMA') + ' VND'}"></small>
                                            </td>
                                            <td class="text-center">
                                                <small th:text="${hoaDonChiTiet.sanPhamChiTiet.mauSac.tenMauSac}"></small><br>
                                            </td>
                                            <td class="text-center">
                                                <input type="number" name="soLuong" th:value="${hoaDonChiTiet.soLuong}"
                                                       min="1" class="form-control"
                                                       th:attr="disabled=${hoaDon.trangThai != 'Ch·ªù X√°c Nh·∫≠n' ? 'disabled' : null}"
                                                       required onchange="updateQuantityOrder(this)">
                                                <input type="hidden" name="hoaDonId" th:value="${hoaDon.id}">
                                                <input type="hidden" name="hoaDonChiTietId"
                                                       th:value="${hoaDonChiTiet.id}">
                                            </td>

                                            <td class="text-center">
                                                <small class="text-danger font-weight-bold fs-5"
                                                       th:text="${#numbers.formatInteger(hoaDonChiTiet.thanhTien, 3, 'COMMA') + ' VND'}"></small><br>
                                            </td>
                                            <td class="text-center">
                                                <span th:class="${hoaDonChiTiet.sanPhamChiTiet.trangThai == 'ƒêang Ho·∫°t ƒê·ªông' ? 'badge bg-danger' : 'badge bg-success'}"
                                                      th:text="${hoaDonChiTiet.sanPhamChiTiet.trangThai}"></span>
                                            </td>
                                            <td class="text-center">
                                                <input type="hidden" name="hoaDonChiTietId"
                                                       th:value="${hoaDonChiTiet.id}">
                                                <input type="hidden" name="hoaDonId" th:value="${hoaDon.id}">
                                                <button type="button" class="btn btn-danger"
                                                        th:attr="disabled=${hoaDon.trangThai != 'Ch·ªù X√°c Nh·∫≠n' ? 'disabled' : null}"
                                                        onclick="deleteProductOrder(this)">
                                                    <i class="fas fa-trash"></i> X√≥a
                                                </button>
                                            </td>
                                        </tr>
                                    </th:block>
                                    </tbody>
                                </table>
                            </div>
                        </section>

                        <!-- Ph·∫ßn Thanh To√°n -->
                        <div style="border: 2px solid; padding: 20px; margin-top: 20px;">
                            <div class="row">
                                <!-- C·ªôt th√¥ng tin giao h√†ng b√™n tr√°i -->
                                <div class="col-md-6">

                                </div>

                                <!-- C·ªôt th√¥ng tin thanh to√°n b√™n ph·∫£i -->
                                <div class="col-md-6">
                                    <h3><i class="fas fa-wallet"></i> Th√¥ng tin thanh to√°n</h3>

                                    <!-- Ph∆∞∆°ng th·ª©c thanh to√°n -->
                                    <div class="d-flex align-items-center mb-4">
    <span>
        <i class="fas fa-credit-card"></i>
        <strong>Ph∆∞∆°ng th·ª©c thanh to√°n: </strong>
        <span id="paymentMethodText"
              th:text="${hoaDon.phuongThucThanhToan != null ? hoaDon.phuongThucThanhToan.tenPhuongThuc : 'Ch∆∞a c√≥ ph∆∞∆°ng th·ª©c'}"></span>
    </span>

                                        <!-- M·ªü modal -->
                                        <button type="button" class="btn btn-outline-primary ms-auto"
                                                data-bs-toggle="modal"
                                                data-bs-target="#paymentModal"
                                                th:attr="disabled=${hoaDon.trangThai != 'Ch·ªù X√°c Nh·∫≠n' ? 'disabled' : null}">
                                            <i class="bi bi-credit-card"></i>
                                        </button>
                                    </div>

                                    <!-- Modal ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n -->
                                    <div class="modal fade" id="paymentModal" tabindex="-1"
                                         aria-labelledby="paymentModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="paymentModalLabel">Ch·ªçn ph∆∞∆°ng th·ª©c
                                                        thanh to√°n</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <form id="paymentMethodForm">
                                                        <input type="hidden" name="hoaDonId"
                                                               th:value="${hoaDon != null ? hoaDon.id : ''}">

                                                        <div class="mb-3">
                                                            <label class="form-label"><i class="fas fa-credit-card"></i>
                                                                Ph∆∞∆°ng th·ª©c thanh to√°n:</label>
                                                            <div class="btn-group w-100" role="group"
                                                                 aria-label="Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n">
                                                                <th:block
                                                                        th:each="phuongThucThanhToan : ${listPhuongThucThanhToan}">
                                                                    <input type="hidden" id="phiShip"
                                                                           th:value="${hoaDon.phiShip}">
                                                                    <input type="hidden" id="listPhieuGiamGia"
                                                                           th:value="${hoaDon.phieuGiamGia != null ? hoaDon.phieuGiamGia.giaTri : 0}">
                                                                    <input type="radio" class="btn-check"
                                                                           name="phuongThucThanhToanId"
                                                                           th:id="'payment-' + ${phuongThucThanhToan.id}"
                                                                           th:value="${phuongThucThanhToan.id}"
                                                                           autocomplete="off">
                                                                    <label class="btn btn-outline-primary"
                                                                           th:for="'payment-' + ${phuongThucThanhToan.id}"
                                                                           th:text="${phuongThucThanhToan.tenPhuongThuc}"></label>
                                                                </th:block>
                                                            </div>
                                                        </div>


                                                        <!-- Form nh·∫≠p s·ªë ti·ªÅn (ch·ªâ hi·ªÉn th·ªã n·∫øu ch·ªçn Ti·ªÅn M·∫∑t) -->
                                                        <div id="paymentDetails">
                                                            <!-- N·ªôi dung ƒë·ªông s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                                                        </div>

                                                        <button type="button" id="addPaymentMethodButton"
                                                                class="btn btn-primary">
                                                            C·∫≠p nh·∫≠t
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- M√£ Gi·∫£m Gi√° -->
                                    <div class="d-flex align-items-center mb-4">
                                    <span>
                                        <i class="fas fa-tag"></i>
                                        <strong>M√£ gi·∫£m gi√°: </strong>
                                        <span th:text="${hoaDon.phieuGiamGia != null ? hoaDon.phieuGiamGia.tenChuongTrinh : 'Ch∆∞a c√≥ phi·∫øu gi·∫£m gi√°'}"></span>
                                    </span>

                                        <!-- M·ªü modal ch·ªçn m√£ gi·∫£m gi√° -->
                                        <button type="button" class="btn btn-outline-primary ms-auto"
                                                data-bs-toggle="modal"
                                                data-bs-target="#discountModal">
                                            <i class="fas fa-tag"></i>
                                        </button>

                                        <!-- Modal m√£ gi·∫£m gi√° -->
                                        <div class="modal fade" id="discountModal" tabindex="-1"
                                             aria-labelledby="discountModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="discountModalLabel">Ch·ªçn m√£ gi·∫£m
                                                            gi√°</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                                aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <form id="applyDiscountForm">
                                                            <input type="hidden" name="hoaDonId" id="hoaDonId"
                                                                   th:value="${hoaDon != null ? hoaDon.id : ''}">
                                                            <div class="mb-3">
                                                                <label for="tenChuongTrinh" class="form-label">
                                                                    <i class="fas fa-tag"></i> M√£ gi·∫£m gi√°:
                                                                </label>
                                                                <select id="tenChuongTrinh" name="tenChuongTrinh"
                                                                        class="form-select">
                                                                    <option value="" disabled selected>Ch·ªçn phi·∫øu gi·∫£m
                                                                        gi√°
                                                                    </option>
                                                                    <th:block
                                                                            th:each="phieuGiamGia : ${listPhieuGiamGia}">
                                                                        <option th:value="${phieuGiamGia.tenChuongTrinh}"
                                                                                th:text="${phieuGiamGia.tenChuongTrinh + ' ( ' + #numbers.formatInteger(phieuGiamGia.giaTri, 3, 'COMMA') + ' ' + 'VND' + ' ) ' }">
                                                                        </option>
                                                                    </th:block>
                                                                </select>
                                                            </div>
                                                            <button type="button" class="btn btn-primary"
                                                                    onclick="applyPhieuGiamGia(this)">√Åp d·ª•ng
                                                            </button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Ph√≠ Ship -->
                                    <div class="info mb-4">
                                        <span><i class="fas fa-box"></i> Ph√≠ Ship:</span>
                                        <span th:text="${hoaDon.phiShip != 0 ? #numbers.formatInteger(hoaDon.phiShip, 3, 'COMMA') + ' VND' : '0 VND'}"></span>
                                    </div>

                                    <!-- Ti·ªÅn h√†ng -->
                                    <div class="info mb-4">
                                        <span><i class="fas fa-box"></i> Ti·ªÅn h√†ng:</span>
                                        <span th:text="${(hoaDon.tongTien != null && hoaDon.tongTien != 0) ?
                                    #numbers.formatInteger(hoaDon.tongTien + (hoaDon.phieuGiamGia != null ? hoaDon.phieuGiamGia.giaTri : 0) - hoaDon.phiShip, 3, 'COMMA') + ' VNƒê'
                                    : '0 VND'}"></span>
                                    </div>

                                    <!-- Gi·∫£m Gi√° -->
                                    <div class="info mb-4">
                                        <span><i class="fas fa-percent"></i> Gi·∫£m gi√°:</span>
                                        <span th:text="${hoaDon.phieuGiamGia != null ? hoaDon.phieuGiamGia.giaTri + ' VNƒê' : '0 VNƒê'}"></span>
                                    </div>

                                    <!-- T·ªïng Ti·ªÅn -->
                                    <div class="info mb-3">
                                        <!-- T·ªïng Ti·ªÅn -->
                                        <div class="info mb-3">
                                            <strong>T·ªïng ti·ªÅn:</strong>
                                            <strong>
                                            <span th:text="${(hoaDon.tongTien != null && hoaDon.tongTien != 0) ?
                                                    #numbers.formatInteger(hoaDon.tongTien, 3, 'COMMA') + ' VNƒê'
                                                    : '0 VNƒê'}"></span>
                                                <span data-bs-toggle="modal" data-bs-target="#infoModal">
                                                <i class="bi bi-question-circle"></i>
                                            </span>
                                            </strong>
                                        </div>

                                        <!-- Modal -->
                                        <div class="modal fade" id="infoModal" tabindex="-1"
                                             aria-labelledby="infoModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="infoModalLabel">C√°ch t√≠nh T·ªïng
                                                            ti·ªÅn</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                                aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <p>C√¥ng th·ª©c t√≠nh t·ªïng ti·ªÅn l√†:</p>
                                                        <ul>
                                                            <li><strong> T·ªïng Th√†nh Ti·ªÅn </strong> - <strong>Gi√° tr·ªã
                                                                phi·∫øu gi·∫£m gi√°</strong> + <strong>Ph√≠ v·∫≠n
                                                                chuy·ªÉn</strong></li>
                                                            <span th:text="${(hoaDon.tongTien != null && hoaDon.tongTien != 0) ?
                                                            #numbers.formatInteger(hoaDon.tongTien + (hoaDon.phieuGiamGia != null ?
                                                            hoaDon.phieuGiamGia.giaTri : 0) - hoaDon.phiShip, 3, 'COMMA') + ' VNƒê'
                                                            : '0 VND'}"></span> -
                                                            <span th:text="${(hoaDon.phieuGiamGia != null && hoaDon.phieuGiamGia.giaTri != 0) ?
                                                            #numbers.formatInteger((hoaDon.phieuGiamGia != null ?
                                                            hoaDon.phieuGiamGia.giaTri : 0), 3, 'COMMA') + ' VNƒê'
                                                            : '0 VND'}"></span> +
                                                            <span th:text="${(hoaDon.phiShip != null && hoaDon.phiShip != 0) ?
                                                            #numbers.formatInteger((hoaDon.phiShip != null ?
                                                            hoaDon.phiShip : 0), 3, 'COMMA') + ' VNƒê'
                                                            : '0 VND'}"></span> =
                                                            <span th:text="${(hoaDon.tongTien != null && hoaDon.tongTien != 0) ?
                                                    #numbers.formatInteger(hoaDon.tongTien, 3, 'COMMA') + ' VNƒê'
                                                    : '0 VNƒê'}"></span>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.box -->

        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    <div th:replace="admin/fragments/footer :: footer"></div>


</div>
<!-- ./wrapper -->

<!-- jQuery 3 -->

<!-- D·ªØ li·ªáu Thymeleaf ƒë∆∞·ª£c nh√∫ng v√†o JavaScript -->
<div th:replace="admin/fragments/script :: script"></div>
<script>
    function showToast(message, type) {
        const toast = document.getElementById("toast-message");
        const toastText = document.getElementById("toast-text");
        const toastLoadingBar = document.getElementById("toast-loading-bar").querySelector(".progress-bar");

        // X√≥a t·∫•t c·∫£ c√°c class m√†u tr∆∞·ªõc ƒë√≥
        toast.classList.remove("text-bg-primary", "text-bg-success", "text-bg-danger");
        toastLoadingBar.classList.remove("bg-light", "bg-success", "bg-danger");

        // G√°n m√†u m·ªõi d·ª±a tr√™n lo·∫°i th√¥ng b√°o
        toast.classList.add(`text-bg-${type}`);
        toastLoadingBar.classList.add(type === "primary" ? "bg-light" : type === "success" ? "bg-success" : "bg-danger");

        // Hi·ªÉn th·ªã toast
        toast.classList.remove("hide");
        toast.classList.add("show");
        toastText.textContent = message;
        toastLoadingBar.style.width = "0%";

        return toastLoadingBar;
    }
</script>

<script>
    function moModalXacNhanChung(button, modalId) {
        let hoaDonId = button.getAttribute("data-hoaDonId");
        let modal = new bootstrap.Modal(document.getElementById(modalId));
        document.getElementById("btnXacNhanChung").setAttribute("data-hoaDonId", hoaDonId);
        document.getElementById("btnXacNhanChung").setAttribute("data-apiEndpoint", button.getAttribute("data-apiEndpoint"));
        modal.show();
    }

    document.getElementById("btnXacNhanChung").addEventListener("click", function () {
        let hoaDonId = this.getAttribute("data-hoaDonId");
        let apiEndpoint = this.getAttribute("data-apiEndpoint");

        if (!hoaDonId || !apiEndpoint) return;

        let modal = bootstrap.Modal.getInstance(document.getElementById("xacNhanChungModal"));
        modal.hide();

        const toastLoadingBar = showToast("ƒêang x·ª≠ l√Ω, vui l√≤ng ch·ªù...", "primary");

        let progress = 0;
        const loadingInterval = setInterval(() => {
            if (progress < 90) {
                progress += 10;
                toastLoadingBar.style.width = `${progress}%`;
            }
        }, 400);

        fetch(apiEndpoint, {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: `hoaDonId=${hoaDonId}`
        })
            .then(response => response.json())
            .then(data => {
                clearInterval(loadingInterval);
                toastLoadingBar.style.width = "100%";

                setTimeout(() => {
                    showToast(data.message || "Thao t√°c th√†nh c√¥ng!", "success");

                    setTimeout(() => {
                        document.getElementById("toast-message").classList.remove("show");
                        document.getElementById("toast-message").classList.add("hide");

                        setTimeout(() => {
                            location.reload();
                        }, 500);
                    }, 2000);
                }, 500);
            })
            .catch(error => {
                console.error("L·ªói:", error);
                clearInterval(loadingInterval);
                toastLoadingBar.style.width = "100%";

                setTimeout(() => {
                    showToast("C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i.", "danger");
                    setTimeout(() => {
                        document.getElementById("toast-message").classList.remove("show");
                        document.getElementById("toast-message").classList.add("hide");
                    }, 4000);
                }, 500);
            });
    });
</script>
<!-- JavaScript -->
<div th:replace="~{admin/shop/script :: script}"></div>

</body>
</html>
